const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/js/three-vendor-TblYD1mt.js","assets/js/react-vendor-4ga91NY9.js","assets/js/chart-vendor-_GeZekKK.js","assets/js/mui-vendor-B_Gf3d1M.js","assets/js/ZonePage-pZzaYJ7c.js","assets/js/Internal_Log-BRrFAqCD.js"])))=>i.map(i=>d[i]);
import{_ as e}from"./index-6eqrfJYO.js";import{j as t,C as n,e as s,T as a}from"./mui-vendor-B_Gf3d1M.js";import{a as r}from"./react-vendor-4ga91NY9.js";import{C as o,S as i,O as c,B as l,a as d,T as u,b as h,M as f,g as p,L as g,G as w,c as m,V as b,Q as y}from"./three-vendor-TblYD1mt.js";import"./chart-vendor-_GeZekKK.js";const k=r.lazy(()=>e(()=>import("./three-vendor-TblYD1mt.js").then(e=>e.q),__vite__mapDeps([0,1,2,3]))),x=r.lazy(()=>e(()=>import("./ZonePage-pZzaYJ7c.js"),__vite__mapDeps([4,3,1,0,2]))),v=r.lazy(()=>e(()=>import("./Internal_Log-BRrFAqCD.js"),__vite__mapDeps([5,3,1]))),j=new Map,z=e=>"object"==typeof e?e.id:e,S=e=>e&&"object"==typeof e?e.id??String(e):String(e),C=e=>{e=String(e||"");let t=0;for(let n=0;n<e.length;n++)t=131*t+e.charCodeAt(n)>>>0;return t},E=(()=>{const e=new WeakMap;return t=>{if(e.has(t))return e.get(t);const n=new Map;return t.forEach(e=>{const t=z(e.source),s=z(e.target);n.has(t)||n.set(t,new Set),n.has(s)||n.set(s,new Set),n.get(t).add(s),n.get(s).add(t)}),e.set(t,n),n}})(),M={firewall:51,router:41,l3switch:27,switchrouter:27,layer3:27,switch:14,server:0,host:-14,hub:-14,default:-7},_=4,N=6;function L(e,{x:t,y:n,z:s}){e.x=t,e.y=n,e.z=s}function I(e){return null==e?null:Number.isFinite(e)?e:Number(e)}function D(e,t,n,s){const a=(new b).subVectors(n,t),r=a.length();if(r<1e-6)return void(e.visible=!1);e.visible=!0;const o=(new b).addVectors(t,n).multiplyScalar(.5);e.position.copy(o),e.quaternion.setFromUnitVectors(new b(0,1,0),a.clone().normalize()),e.scale.set(s,r,s)}function P(e){const t="core"===e.kind?1.8:1.35+.08*(e.__deg||0);return 1.7*Math.max(1.2,Math.min(3.2,t))}function T(e){return function(e){switch((e||"default").toLowerCase()){case"core":return 7.5;case"firewall":return 4.8;case"router":return 4.6;case"l3switch":case"switchrouter":case"layer3":return 5;case"switch":case"l2switch":case"hub":return 4.2;default:return 3.4}}(e.kind)*P(e)+2}const $=r.memo(function({activeView:e="default",onInspectorChange:$}){const R=r.useRef(null),[A,V]=r.useState({nodes:[],links:[]}),[O,F]=r.useState(null),[B,U]=r.useState(!0),[W,Z]=r.useState(!1),[q,G]=r.useState(e);r.useEffect(()=>{G(e)},[e]),r.useEffect(()=>{let e=!0;return(async()=>{U(!0),Z(!1);try{let t=j.get(q);t||(t=await async function(e="internaltopology",t=null){try{let e="http://localhost:8000/neo4j/nodes?activeView=internaltopology";t&&(e+=`&project=${encodeURIComponent(t)}`);const n=await fetch(e);if(!n.ok)throw new Error("Network response was not ok");const s=await n.json(),a=new Map,r=[];s.forEach(e=>{e.src_IP?.id&&a.set(e.src_IP.id,e.src_IP),e.dst_IP?.id&&a.set(e.dst_IP.id,e.dst_IP),e.edge?.sourceIP&&e.edge?.targetIP&&r.push({source:e.edge.sourceIP,target:e.edge.targetIP,...e.edge})});const o=new Set(a.keys()),i=r.filter(e=>o.has(e.source)&&o.has(e.target)),c=r.filter(e=>!o.has(e.source)||!o.has(e.target));if(c.length){const e="__core__";a.has(e)||a.set(e,{id:e,label:"CORE",kind:"core",type:"core",color:"#ffffff",status:"up",zone:null}),c.forEach(t=>{const n=o.has(t.source),s=o.has(t.target);n&&!s?i.push({...t,target:e,type:t.type||"logical"}):!n&&s&&i.push({...t,source:e,type:t.type||"logical"})})}const l=new Map;i.forEach(e=>{const t=String(e.source),n=String(e.target),s=t<n?`${t}__${n}__${e.type||""}`:`${n}__${t}__${e.type||""}`;l.has(s)||l.set(s,e)});const d=Array.from(l.values()),u={core:"#ffffff",firewall:"#e55353",router:"#f6a609",l3switch:"#f6a609",switchrouter:"#f6a609",layer3:"#f6a609",switch:"#3fb950",hub:"#26c6da",server:"#6aa7ff",host:"#6aa7ff",default:"#a0b4ff"};return{nodes:Array.from(a.values()).map(e=>{const t=(e.kind||e.type||"host").toLowerCase(),n=e.label||e.ip||String(e.id),s=e.color||u[t]||u.default,a=e.status||"up",r=e.subnet||("string"==typeof e.ip&&e.ip.includes(".")?e.ip.split(".").slice(0,3).join(".")+".0/24":"unknown/24"),o=Number.isFinite(e.zone)?e.zone:"core"===e.kind?null:0;return{...e,kind:t,label:n,color:s,status:a,subnet:r,zone:o}}),links:d}}catch(n){return{nodes:[],links:[]}}}(q),j.set(q,t));const n={nodes:t.nodes.map(e=>({...e})),links:t.links.map(e=>({...e}))},s=new Map;n.links.forEach(e=>{s.set(z(e.source),(s.get(z(e.source))||0)+1),s.set(z(e.target),(s.get(z(e.target))||0)+1)}),n.nodes.forEach(e=>e.__deg=s.get(e.id)||0);const a=n.nodes.filter(e=>null!==I(e.zone)),r=new Set(a.map(e=>e.id));n.links=n.links.filter(e=>r.has(z(e.source))&&r.has(z(e.target))),n.nodes=a;const o=function(e){const t=new Map,n=e.filter(e=>null!==e),s=n.length;let a=420;if(s>1){const e=234/(Math.sin(Math.PI/s)||.001);a=Math.max(420,Math.ceil(e))}const r=2*Math.PI/Math.max(1,s);return n.forEach((e,n)=>{t.set(e,{x:Math.cos(n*r)*a,y:Math.sin(n*r)*a,z:0})}),t}(Array.from(new Set(n.nodes.map(e=>I(e.zone)))).filter(e=>null!==e)),i=Math.max(280,420);n.nodes.forEach(e=>{if("core"===e.kind)return L(e,{x:0,y:0,z:0}),e.fx=0,e.fy=0,void(e.fz=0);if(0===I(e.zone)&&"firewall"===String(e.kind).toLowerCase())return L(e,{x:0,y:0,z:M.firewall||0}),e.fx=0,e.fy=0,void(e.fz=M.firewall||0);const t=I(e.zone),n=o.get(t)||{x:(Math.random()-.5)*i*2,y:(Math.random()-.5)*i*2,z:0},s=i*(.12+.45*Math.random()),a=Math.random()*Math.PI*2;L(e,{x:n.x+Math.cos(a)*s,y:n.y+Math.sin(a)*s,z:(M[e.kind]??0)+18*(Math.random()-.5)})}),e&&(V(n),F(null))}catch(t){}finally{e&&U(!1)}})(),()=>{e=!1}},[q]);const H=r.useMemo(()=>new Map,[]),K=r.useMemo(()=>new Map,[]);r.useEffect(()=>{const e=R.current;if(e){try{const t=e.d3Force("charge");t&&t.strength(-48)}catch(t){}try{const t=e.d3Force("link");if(!t)return;t.distance(e=>{const t=String(e.source?.id??e.source),n=String(e.target?.id??e.target),s=t<n?`${t}/${n}/${e.type||""}`:`${n}/${t}/${e.type||""}`;if(H.has(s))return H.get(s);const a=String(e.source?.kind||"").toLowerCase(),r=String(e.target?.kind||"").toLowerCase(),o=0===e.source?.zone&&"firewall"===a||0===e.target?.zone&&"firewall"===r,i="physical"===String(e.type||"").toLowerCase()?90:130,c=["host","server","hub"],l=["router","switch","l3switch","switchrouter","layer3"],d=c.includes(a)&&l.includes(r)||c.includes(r)&&l.includes(a),u=o?52:d?Math.round(1.2*i):i;return H.set(s,u),u}).strength(e=>{const t=String(e.source?.id??e.source),n=String(e.target?.id??e.target),s=t<n?`${t}/${n}/${e.type||""}`:`${n}/${t}/${e.type||""}`;if(K.has(s))return K.get(s);const a=String(e.source?.kind||"").toLowerCase(),r=String(e.target?.kind||"").toLowerCase(),o=0===e.source?.zone&&"firewall"===a||0===e.target?.zone&&"firewall"===r?1:.9;return K.set(s,o),o})}catch(t){}}},[A?.links?.length]);const Q=r.useMemo(()=>{const e=new Set;return A.nodes.forEach(t=>{const n=I(t.zone);null===n||Number.isNaN(n)||e.add(n)}),Array.from(e).sort((e,t)=>e-t)},[A.nodes]),J=r.useMemo(()=>{const e=new Map;return Q.forEach(t=>e.set(t,0)),A.nodes.forEach(t=>{const n=I(t.zone);e.has(n)&&e.set(n,(e.get(n)||0)+1)}),e},[A.nodes,Q]),[X,Y]=r.useState([]);r.useEffect(()=>{Y(Q)},[Q]);const[ee,te]=r.useState("all"),[ne,se]=r.useState(null),ae=r.useMemo(()=>{const e=function(e,t){if(!e||!e.nodes)return{nodes:[],links:[]};const n=new Set(t??[]);if(0===n.size)return{nodes:[],links:[]};const s=new Set(e.nodes.filter(e=>n.has(I(e.zone))).map(e=>e.id)),a=e.links.filter(e=>s.has(z(e.source))||s.has(z(e.target))),r=new Set([...s]);a.forEach(e=>{r.add(z(e.source)),r.add(z(e.target))});const o=new Set(e.nodes.filter(e=>"core"===e.kind).map(e=>e.id));o.size&&e.links.forEach(e=>{const t=z(e.source),n=z(e.target);(o.has(t)&&r.has(n)||o.has(n)&&r.has(t))&&(r.add(t),r.add(n))}),e.nodes.forEach(e=>{0===I(e.zone)&&"firewall"===String(e.kind).toLowerCase()&&r.add(e.id)});const i=e.links.filter(e=>r.has(z(e.source))&&r.has(z(e.target)));return{nodes:e.nodes.filter(e=>r.has(e.id)||n.has(I(e.zone))),links:i}}(A,X);if(!e||!e.links)return e;let t=e.links;if("all"!==ee){const e="physical"===ee;t=t.filter(t=>String(t.type||"").toLowerCase()===(e?"physical":"logical"))}const n=new Set;let s;return t.forEach(e=>{n.add(z(e.source)),n.add(z(e.target))}),s="all"===ee?e.nodes.filter(e=>n.has(e.id)||X.includes(I(e.zone))):e.nodes.filter(e=>n.has(e.id)),{nodes:s,links:t}},[A,X,ee]),re=r.useMemo(()=>E(ae.links),[ae.links]),[oe,ie]=r.useState(null);r.useEffect(()=>{ie(O?.id??null)},[O]);const ce=r.useCallback(e=>oe&&(e.id===oe||re.get(oe)?.has(e.id)),[oe,re]),le=r.useCallback(e=>oe&&(z(e.source)===oe||z(e.target)===oe),[oe]);r.useEffect(()=>{const e=t.jsxs("div",{className:"inspector-panel",children:[t.jsxs("div",{className:"inspector-header",children:[t.jsx("h2",{children:"Node"}),O&&t.jsxs("span",{className:"node-label",children:["Zone ",String(I(O.zone))]})]}),O?t.jsx("div",{className:"inspector-content",children:t.jsx("table",{children:t.jsxs("tbody",{children:[["label","kind","ip","subnet","zone","id"].map(e=>t.jsxs("tr",{children:[t.jsx("td",{children:e}),t.jsx("td",{children:String(O[e]??"")})]},e)),t.jsxs("tr",{children:[t.jsx("td",{children:"이웃연결수"}),t.jsx("td",{children:re.get(O.id)?.size??0})]})]})})}):t.jsx("div",{className:"inspector-placeholder",children:"노드를 클릭하면 상세 정보가 표시됩니다."})]});$?.(e)},[O,$,re]);const de=r.useMemo(()=>({torus:new u(7,1.6,16,32),cone:new d(4.2,9,10),cylinder:new o(4.2,4.2,8,18),box:new l(8.2,2.6,6.2),l3top:new o(2.8,2.8,2.2,16),sphere:new i(3,16,16),octa:new c(4.2),led:new i(.7,8,8),hit:new i(7,8,8),dashUnit:new o(1,1,1,10)}),[]),ue=r.useMemo(()=>({base:new Map,highlight:new f({color:16767609,metalness:.25,roughness:.72}),dim:new f({color:3293269,metalness:.25,roughness:.72}),ledUp:new h({color:65433}),ledDown:new h({color:16724821}),hit:new h({opacity:0,transparent:!0,depthWrite:!1}),dashedBase:new h({color:8891132,transparent:!0,opacity:.95}),dashedInc:new h({color:3829730,transparent:!0,opacity:1})}),[]),he=r.useCallback(e=>{let t=ue.base.get(e);return t||(t=new f({color:new p(e),metalness:.25,roughness:.72}),ue.base.set(e,t)),t},[ue]),fe=r.useMemo(()=>({dashed:new g({color:8891132,dashSize:2.2,gapSize:2.2,transparent:!0,opacity:.95}),dashedInc:new g({color:3829730,dashSize:4.4,gapSize:3.2,transparent:!0,opacity:1}),basic:new h({color:11123199}),basicInc:new h({color:3829730})}),[]),pe=r.useCallback(e=>{const t=new w,n=e.color||"#a0b4ff",s=oe?ce(e)?ue.highlight:ue.dim:he(n);let a;if("core"===e.kind)a=new m(de.torus,s);else if("firewall"===e.kind)a=new m(de.cone,s);else if("router"===e.kind)a=new m(de.cylinder,s);else if("switch"===e.kind||"l2switch"===e.kind)a=new m(de.box,s);else if("l3switch"===e.kind||"switchrouter"===e.kind||"layer3"===e.kind){const e=new m(de.box,s),t=new m(de.l3top,s);t.position.y=2.6;const n=new w;n.add(e),n.add(t),a=n}else a="hub"===e.kind?new m(de.octa,s):new m(de.sphere,s);const r=P(e);a.scale.set(r,r,r),a.castShadow=!1,a.receiveShadow=!1,t.add(a);const o=new m(de.led,"up"===e.status?ue.ledUp:ue.ledDown);o.position.set(0,"core"===e.kind?8:6*r*.9,0),t.add(o);const i=new m(de.hit,ue.hit);return i.name="hit-proxy",t.add(i),t},[oe,he,ce,ue,de]),ge=r.useCallback(e=>"logical"===String(e.type||"").toLowerCase(),[]),we=r.useCallback(e=>"physical"===String(e.type||"").toLowerCase(),[]),me=r.useCallback(e=>ge(e)?0:oe&&le(e)?N:_,[ge,oe,le]),be=r.useCallback(e=>ge(e)?oe&&le(e)?fe.dashedInc:fe.dashed:oe&&le(e)?fe.basicInc:fe.basic,[ge,oe,le,fe]),ye=r.useCallback(e=>oe?le(e)?"#3a6fe2":ge(e)?"#87aafc":"#7f90b8":ge(e)?"#87aafc":"#a9b9ff",[oe,le,ge]),ke=r.useCallback(e=>ge(e)?0:oe?le(e)?4:0:2,[ge,oe,le]),xe=r.useCallback(e=>we(e)?.006:0,[we]),ve=r.useCallback(e=>we(e)?.05:.16,[we]),je=r.useCallback(e=>(C(z(e.source))+C(z(e.target)))%628/100,[]),ze=r.useCallback(e=>{if(!ge(e))return;if("logical"!==ee&&!oe)return;const t=new w;return t.userData={type:"logical-dashed",link:e,dashes:[]},t},[ge,ee,oe]),Se=r.useCallback((e,t)=>{const n=S(e.source),s=S(e.target),a="object"==typeof e.source&&e.source||ae.nodes.find(e=>e.id===n)||A.nodes.find(e=>e.id===n),r="object"==typeof e.target&&e.target||ae.nodes.find(e=>e.id===s)||A.nodes.find(e=>e.id===s);if(!a||!r)return void(t.visible=!1);if([a.x,a.y,a.z,r.x,r.y,r.z].some(e=>"number"!=typeof e))return void(t.visible=!1);const o=function(e,t,n,s){const a=(new b).subVectors(t,e),r=a.length()||1,o=(new b).addVectors(e,t).multiplyScalar(.5),i=Math.abs(a.x)<.9?new b(1,0,0):new b(0,1,0),c=(new b).crossVectors(a,i).normalize();c.applyAxisAngle(a.clone().normalize(),s);const l=n*r*2,d=c.multiplyScalar(l).add(o);return new y(e,d,t)}(new b(a.x,a.y,a.z),new b(r.x,r.y,r.z),ve(e),(C(n)+C(s))%628/100),i=Math.max(1e-6,o.getLength()),c=T(a),l=T(r);if(i<=1.05*(c+l))return void(t.visible=!1);const d=Math.min(.49,c/i),u=1-Math.min(.49,l/i),h=R.current?.camera()?.position?.z??800,f=h>900?6:h>700?10:16;!function(e,t,n,s,a){e.userData.dashes||(e.userData.dashes=[]);const r=e.userData.dashes;for(;r.length<t;){const t=new m(n,s);t.castShadow=!1,t.receiveShadow=!1,r.push(t),e.add(t)}for(;r.length>t;){const t=r.pop();e.remove(t)}e.userData.matBase=s,e.userData.matInc=a}(t,f,de.dashUnit,ue.dashedBase,ue.dashedInc);const p=!(!oe||n!==oe&&s!==oe),g=p?2.8:1.35,w=p?t.userData.matInc:t.userData.matBase,k=Math.min(.6*g,1.2),x=u-d;if(x<=1e-4)t.visible=!1;else{for(let e=0;e<f;e++){const n=d+e/f*x,s=d+Math.min(u,(e+.58)/f*x),a=Math.max(d,n),r=Math.min(u,s),i=t.userData.dashes[e];if(!i||r-a<=1e-4){i&&(i.visible=!1);continue}const c=o.getPoint(a),l=o.getPoint(r),h=(new b).subVectors(l,c);if(h.length()<.001){i.visible=!1;continue}h.normalize();const p=c.clone().addScaledVector(h,k),m=l.clone().addScaledVector(h,-k);i.material=w,i.renderOrder=2,i.material&&(i.material.depthTest=!0,i.material.depthWrite=!1,i.material.needsUpdate=!0),D(i,p,m,Math.max(.18,g))}t.visible=!0}},[ae.nodes,A.nodes,de.dashUnit,ue.dashedBase,ue.dashedInc,oe,ve]),Ce=r.useCallback(()=>{const e=R.current?.scene?.();e&&e.traverse(e=>{"logical-dashed"===e.userData?.type&&e.userData.link&&(Se(e.userData.link,e),e.visible=!0)})},[Se]),Ee=r.useCallback(e=>{const t=ae.nodes.find(t=>t.id===e)||A.nodes.find(t=>t.id===e);if(!t)return;F(t);const n=1+300/Math.hypot(t.x||1,t.y||1,t.z||1);R.current?.cameraPosition({x:(t.x||1)*n,y:(t.y||1)*n,z:640},t,900)},[ae.nodes,A.nodes]);r.useEffect(()=>{const e=setTimeout(()=>{const e=A.nodes.find(e=>"core"===e.kind);e&&Ee(e.id)},300);return()=>clearTimeout(e)},[A.nodes,Ee]);const Me=r.useCallback(e=>{F(t=>t&&I(t.zone)===e?null:t),Y(t=>{const n=new Set(t);return n.has(e)?n.delete(e):n.add(e),Array.from(n).sort((e,t)=>e-t)})},[]),_e=r.useCallback(()=>Y(Q),[Q]),Ne=r.useCallback(()=>Y([]),[]),Le=r.useRef(!1);r.useEffect(()=>{const e=R.current;if(!e)return;const t=e.controls&&e.controls(),n=e.renderer&&e.renderer();if(!t||!n)return;t.enablePan=!0,t.screenSpacePanning=!0,t.listenToKeyEvents&&t.listenToKeyEvents(window),t.keyPanSpeed=8;const s=n.domElement;let a=!1;const r=()=>{s&&(s.style.cursor=a?"grab":"")},o=e=>{"Space"!==e.code&&" "!==e.key||a||(a=!0,Le.current=!0,r(),t.mouseButtons.LEFT=2,e.preventDefault())},i=e=>{"Space"!==e.code&&" "!==e.key||(a=!1,Le.current=!1,r(),t.mouseButtons.LEFT=0)},c=()=>{a&&s&&(s.style.cursor="grabbing")},l=()=>{a&&s&&(s.style.cursor="grab")};return window.addEventListener("keydown",o,{passive:!1}),window.addEventListener("keyup",i),s.addEventListener("mousedown",c),window.addEventListener("mouseup",l),t.mouseButtons.RIGHT=2,()=>{window.removeEventListener("keydown",o),window.removeEventListener("keyup",i),s.removeEventListener("mousedown",c),window.removeEventListener("mouseup",l)}},[]);const Ie=r.useRef(null),[De,Pe]=r.useState({width:0,height:0}),Te=r.useCallback(()=>{const e=Ie.current;if(e)try{Pe({width:e.clientWidth||0,height:e.clientHeight||0})}catch{}},[]);r.useEffect(()=>{const e=Ie.current;if(!e)return;let t;if(Te(),"undefined"!=typeof ResizeObserver){t=new ResizeObserver(Te);try{t.observe(e)}catch{}}else window.addEventListener("resize",Te);return()=>{try{t&&e&&t.unobserve(e)}catch{}window.removeEventListener("resize",Te)}},[Te]),r.useEffect(()=>{const e=R.current?.renderer?.();try{e?.setPixelRatio(Math.min(window.devicePixelRatio||1,1.5))}catch{}},[De.width,De.height]),r.useEffect(()=>{const e=()=>{try{R.current?.zoomToFit(600,40)}catch{}};(ae.nodes?.length||ae.links?.length)&&requestAnimationFrame(e);const t=Ie.current;let n;return t&&"undefined"!=typeof ResizeObserver?(n=new ResizeObserver(()=>requestAnimationFrame(e)),n.observe(t)):window.addEventListener("resize",e),()=>{n&&t&&n.unobserve(t),window.removeEventListener("resize",e)}},[ae]),r.useEffect(()=>()=>{Object.values(de).forEach(e=>{try{e.dispose?.()}catch{}}),ue.base.forEach(e=>{try{e.dispose?.()}catch{}}),[ue.highlight,ue.dim,ue.ledUp,ue.ledDown,ue.hit,ue.dashedBase,ue.dashedInc].forEach(e=>{try{e.dispose?.()}catch{}})},[de,ue]);const[$e,Re]=r.useState([]),Ae=r.useCallback(()=>R.current?.resumeAnimation(),[]);return t.jsx(n,{sx:{width:"100%",height:"calc(100vh - 120px)",bgcolor:"background.paper",borderRadius:2,boxShadow:3,overflow:"hidden"},children:t.jsxs(s,{sx:{p:2,height:"100%",display:"flex",gap:2},children:[t.jsx(n,{sx:{width:280,flex:"none",bgcolor:"#f0edfd",color:"#000",border:"1px solid #d0c9f0",boxShadow:"0 2px 8px rgba(0,0,0,0.1)",borderRadius:"20px",height:"100%",display:"flex",flexDirection:"column"},children:t.jsxs(s,{sx:{p:2,display:"flex",flexDirection:"column",flex:1,height:"100%"},className:"left-sidebar",children:[t.jsx(a,{variant:"h6",sx:{mb:1,fontWeight:600,fontSize:"1rem",color:"#000000ff"},children:"Network Topology"}),t.jsx("div",{className:"divider"}),t.jsx("div",{className:"link-type-header",children:t.jsx(a,{variant:"body2",sx:{fontWeight:600,color:"#000000ff"},children:"Link Type"})}),t.jsxs("div",{className:"link-type-buttons",children:[t.jsx("button",{onClick:()=>{te("physical")},className:"physical"===ee?"active":"inactive",title:"물리 링크만 보기",children:"Physical"}),t.jsx("button",{onClick:()=>{te("logical")},className:"logical"===ee?"active":"inactive",title:"논리 링크(점선)만 보기",children:"Logical"})]}),t.jsx("div",{className:"view-reset-container",children:t.jsx("button",{onClick:()=>{F(null),Y(Q),te("all");const e=A.nodes.find(e=>"core"===e.kind);if(e&&R.current){const t=640,n=1+150/Math.hypot(e.x||1,e.y||1,e.z||1);R.current.cameraPosition({x:(e.x||1)*n,y:(e.y||1)*n,z:t},e,800)}},children:"뷰 초기화"})}),t.jsxs("div",{className:"zones-header",children:[t.jsx("div",{className:"zone-indicator"}),t.jsx(a,{variant:"body1",sx:{fontWeight:600,color:"#000000ff"},children:"Zones"})]}),t.jsx("div",{className:"zones-list",children:Q.map(e=>{const n=X.includes(e),s=J.get(e)||0;return t.jsxs("div",{className:"zone-item "+(n?"active":"inactive"),children:[t.jsx("button",{onClick:()=>se(e),className:"zone-button "+(n?"active":"inactive"),children:t.jsxs("div",{className:"zone-header",children:[t.jsxs("span",{children:["Zone ",e]}),t.jsx("span",{className:"zone-count",children:s})]})}),t.jsx("div",{className:"zone-actions",children:t.jsx("button",{onClick:()=>se(e),title:"존 상세 보기",children:"Details"})})]},e)})}),t.jsxs("div",{className:"zone-filter-section",children:[t.jsx(a,{variant:"body2",sx:{mb:1,fontWeight:600,color:"#000000ff"},children:"Zone Filter"}),t.jsx("form",{children:Q.map(e=>t.jsxs("label",{children:[t.jsx("input",{type:"checkbox",checked:X.includes(e),onChange:()=>Me(e)}),t.jsxs("span",{children:["Zone ",e," ",t.jsxs("span",{className:"zone-count-inline",children:["(",J.get(e)||0,")"]})]})]},e))}),t.jsxs("div",{className:"filter-buttons",children:[t.jsx("button",{onClick:_e,children:"All"}),t.jsx("button",{onClick:Ne,children:"None"})]}),t.jsxs(a,{variant:"caption",sx:{display:"block",mt:.5,color:"#000000ff"},children:[ae.nodes.length," nodes • ",ae.links.length," links"]})]})]})}),t.jsx(n,{sx:{flex:1,height:"100%",position:"relative",overflow:"hidden",borderRadius:"20px",boxShadow:"0 2px 8px rgba(57, 48, 107, 0.07)",background:"#856affff"},children:t.jsxs("div",{ref:Ie,className:"graph-container",role:"img","aria-label":"Internal network topology (800 nodes)",children:[t.jsx(r.Suspense,{fallback:t.jsx("div",{className:"loading-overlay",children:t.jsx("div",{className:"loading-box",children:"Loading Graph..."})}),children:t.jsx(k,{ref:R,rendererConfig:{antialias:!1,alpha:!1,powerPreference:"high-performance"},graphData:ae,backgroundColor:"#F0EDFD",width:De.width,height:De.height,nodeThreeObject:pe,nodeThreeObjectExtend:!1,linkThreeObject:ze,linkThreeObjectExtend:!1,linkWidth:me,linkColor:ye,linkMaterial:be,linkDirectionalParticles:ke,linkDirectionalParticleSpeed:xe,linkDirectionalParticleWidth:2,linkCurvature:ve,linkCurveRotation:je,onEngineTick:r.useCallback(()=>{if("logical"!==ee&&!oe)return;const e=R.current?.scene?.();e&&e.traverse(e=>{if("logical-dashed"!==e.userData?.type)return;const t=e.userData.link,n="object"==typeof t.source?t.source.id:t.source,s="object"==typeof t.target?t.target.id:t.target;oe&&n!==oe&&s!==oe||Se(t,e)})},[Se,oe,ee]),onEngineStop:r.useCallback(()=>{Ce(),R.current?.pauseAnimation(),Z(!0)},[Ce]),onLinkUpdate:r.useCallback((e,t)=>{try{t&&t.computeLineDistances&&t.computeLineDistances()}catch{}if("logical"===String(e.type||"").toLowerCase()){const t=R.current?.scene?.();if(!t)return;t.traverse(t=>{"logical-dashed"===t.userData?.type&&t.userData.link===e&&Se(e,t)})}},[Se]),onNodeClick:r.useCallback(e=>{if(Ae(),F(e),e){const t=re.get(e.id)||new Set,n=Array.from(t).map(e=>{const t=ae.nodes.find(t=>t.id===e);return t?.ip}).filter(e=>e),s=ae.links.filter(t=>{const n="object"==typeof t.source?t.source.id:t.source,s="object"==typeof t.target?t.target.id:t.target;return n===e.id||s===e.id}).map(e=>{const t="object"==typeof e.source?e.source.id:e.source,n="object"==typeof e.target?e.target.id:e.target,s=ae.nodes.find(e=>e.id===t)||A.nodes.find(e=>e.id===t),a=ae.nodes.find(e=>e.id===n)||A.nodes.find(e=>e.id===n);return{src_IP:s?{id:s.id,ip:s.ip,__labels:[s.kind],__id:s.id,index:s.zone}:null,dst_IP:a?{id:a.id,ip:a.ip,__labels:[a.kind],__id:a.id,index:a.zone}:null,edge:{sourceIP:t,targetIP:n,type:e.type,count:e.count}}}),a={message:`노드 선택: ${e.label||e.id}`,nodeInfo:{kind:e.kind,zone:e.zone,ip:e.ip},connectedCount:t.size,connectedIps:n,dbInfo:s};Re([a])}},[re,ae.nodes,ae.links,A.nodes,Ae]),onBackgroundClick:r.useCallback(()=>{F(null),Re([]),Ae()},[Ae]),enableNodeDrag:!1,enablePointerInteraction:W,showNavInfo:!1,warmupTicks:12,cooldownTicks:0,d3AlphaDecay:.06,d3VelocityDecay:.4})}),B&&t.jsx("div",{className:"loading-overlay no-pointer-events",children:t.jsx("div",{className:"loading-box",children:"Loading…"})}),null!==ne&&t.jsxs("div",{className:"zone-detail-overlay",children:[t.jsx("div",{onClick:()=>se(null),className:"overlay-backdrop"}),t.jsx("div",{onClick:e=>e.stopPropagation(),className:"overlay-content",children:t.jsx(r.Suspense,{fallback:t.jsx("div",{className:"overlay-loading",children:"Loading..."}),children:t.jsx(x,{zone:ne,onBack:()=>se(null),onInspectorChange:$,setEventLogs:Re})})})]})]})}),t.jsx(r.Suspense,{fallback:t.jsx("div",{className:"right-sidebar-fallback"}),children:t.jsx(v,{eventLogs:$e})})]})})});export{$ as default};
