const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/js/three-vendor-B0NqEMWZ.js","assets/js/react-vendor-B_dYwot0.js","assets/js/chart-vendor-C90I0JYu.js","assets/js/mui-vendor-DSitpBbk.js","assets/js/ZonePage-pYZ8ypYA.js","assets/js/Internal_Log-BrJidW6_.js"])))=>i.map(i=>d[i]);
import{_ as e}from"./index-CP7jzE9X.js";import{j as t,C as n,e as s}from"./mui-vendor-DSitpBbk.js";import{c as o,a as r}from"./react-vendor-B_dYwot0.js";import{C as i,S as a,O as l,B as d,a as c,T as u,M as h,b as f,c as p,L as g,G as b,d as x,V as y,Q as w}from"./three-vendor-B0NqEMWZ.js";import"./chart-vendor-C90I0JYu.js";const m=r.lazy(()=>e(()=>import("./three-vendor-B0NqEMWZ.js").then(e=>e.q),__vite__mapDeps([0,1,2,3]))),k=r.lazy(()=>e(()=>import("./ZonePage-pYZ8ypYA.js"),__vite__mapDeps([4,3,1,0,2]))),v=r.lazy(()=>e(()=>import("./Internal_Log-BrJidW6_.js"),__vite__mapDeps([5,3,1]))),j=new Map,S=e=>"object"==typeof e?e.id:e,z=e=>e&&"object"==typeof e?e.id??String(e):String(e),C=e=>{e=String(e||"");let t=0;for(let n=0;n<e.length;n++)t=131*t+e.charCodeAt(n)>>>0;return t},E=(()=>{const e=new WeakMap;return t=>{if(e.has(t))return e.get(t);const n=new Map;return t.forEach(e=>{const t=S(e.source),s=S(e.target);n.has(t)||n.set(t,new Set),n.has(s)||n.set(s,new Set),n.get(t).add(s),n.get(s).add(t)}),e.set(t,n),n}})(),M={firewall:51,router:41,l3switch:27,switchrouter:27,layer3:27,switch:14,server:0,host:-14,hub:-14,default:-7},_=4,I=6;function L(e,{x:t,y:n,z:s}){e.x=t,e.y=n,e.z=s}function D(e){return null==e?null:Number.isFinite(e)?e:Number(e)}function R(e,t,n,s){const o=(new y).subVectors(n,t),r=o.length();if(r<1e-6)return void(e.visible=!1);e.visible=!0;const i=(new y).addVectors(t,n).multiplyScalar(.5);e.position.copy(i),e.quaternion.setFromUnitVectors(new y(0,1,0),o.clone().normalize()),e.scale.set(s,r,s)}function P(e){const t="core"===e.kind?1.8:1.35+.08*(e.__deg||0);return 1.7*Math.max(1.2,Math.min(3.2,t))}function T(e){return function(e){switch((e||"default").toLowerCase()){case"core":return 7.5;case"firewall":return 4.8;case"router":return 4.6;case"l3switch":case"switchrouter":case"layer3":return 5;case"switch":case"l2switch":case"hub":return 4.2;default:return 3.4}}(e.kind)*P(e)+2}const F=o.memo(function({activeView:e="default",onInspectorChange:o}){const F=r.useRef(null),[A,B]=r.useState({nodes:[],links:[]}),[V,N]=r.useState(null),[O,W]=r.useState(!0),[U,$]=r.useState(e);r.useEffect(()=>{$(e)},[e]),r.useEffect(()=>{let e=!0;return(async()=>{W(!0);try{let t=j.get(U);t||(t=await async function(e="internaltopology",t=null){try{let e="http://localhost:8000/neo4j/nodes?activeView=internaltopology";t&&(e+=`&project=${encodeURIComponent(t)}`);const n=await fetch(e);if(!n.ok)throw new Error("Network response was not ok");const s=await n.json(),o=new Map,r=[];s.forEach(e=>{e.src_IP?.id&&o.set(e.src_IP.id,e.src_IP),e.dst_IP?.id&&o.set(e.dst_IP.id,e.dst_IP),e.edge?.sourceIP&&e.edge?.targetIP&&r.push({source:e.edge.sourceIP,target:e.edge.targetIP,...e.edge})});const i=new Set(o.keys()),a=r.filter(e=>i.has(e.source)&&i.has(e.target)),l=r.filter(e=>!i.has(e.source)||!i.has(e.target));if(l.length){const e="__core__";o.has(e)||o.set(e,{id:e,label:"CORE",kind:"core",type:"core",color:"#ffffff",status:"up",zone:null}),l.forEach(t=>{const n=i.has(t.source),s=i.has(t.target);n&&!s?a.push({...t,target:e,type:t.type||"logical"}):!n&&s&&a.push({...t,source:e,type:t.type||"logical"})})}const d=new Map;a.forEach(e=>{const t=String(e.source),n=String(e.target),s=t<n?`${t}__${n}__${e.type||""}`:`${n}__${t}__${e.type||""}`;d.has(s)||d.set(s,e)});const c=Array.from(d.values()),u={core:"#ffffff",firewall:"#e55353",router:"#f6a609",l3switch:"#f6a609",switchrouter:"#f6a609",layer3:"#f6a609",switch:"#3fb950",hub:"#26c6da",server:"#6aa7ff",host:"#6aa7ff",default:"#a0b4ff"};return{nodes:Array.from(o.values()).map(e=>{const t=(e.kind||e.type||"host").toLowerCase(),n=e.label||e.ip||String(e.id),s=e.color||u[t]||u.default,o=e.status||"up",r=e.subnet||("string"==typeof e.ip&&e.ip.includes(".")?e.ip.split(".").slice(0,3).join(".")+".0/24":"unknown/24"),i=Number.isFinite(e.zone)?e.zone:"core"===e.kind?null:0;return{...e,kind:t,label:n,color:s,status:o,subnet:r,zone:i}}),links:c}}catch(n){return{nodes:[],links:[]}}}(U),j.set(U,t));const n={nodes:t.nodes.map(e=>({...e})),links:t.links.map(e=>({...e}))},s=new Map;n.links.forEach(e=>{s.set(S(e.source),(s.get(S(e.source))||0)+1),s.set(S(e.target),(s.get(S(e.target))||0)+1)}),n.nodes.forEach(e=>e.__deg=s.get(e.id)||0);const o=n.nodes.filter(e=>null!==D(e.zone)),r=new Set(o.map(e=>e.id));n.links=n.links.filter(e=>r.has(S(e.source))&&r.has(S(e.target))),n.nodes=o;const i=function(e){const t=new Map;e.includes(null)&&t.set(null,{x:0,y:0,z:0});const n=e.filter(e=>null!==e),s=n.length;let o=420;if(s>1){const e=234/(Math.sin(Math.PI/s)||.001);o=Math.max(420,Math.ceil(e))}const r=2*Math.PI/Math.max(1,s);return n.forEach((e,n)=>{t.set(e,{x:Math.cos(n*r)*o,y:Math.sin(n*r)*o,z:0})}),t}(Array.from(new Set(n.nodes.map(e=>D(e.zone)))).filter(e=>null!==e)),a=Math.max(280,420);n.nodes.forEach(e=>{if("core"===e.kind)return L(e,{x:0,y:0,z:0}),e.fx=0,e.fy=0,void(e.fz=0);if(0===D(e.zone)&&"firewall"===String(e.kind).toLowerCase())return L(e,{x:0,y:0,z:M.firewall||0}),e.fx=0,e.fy=0,void(e.fz=M.firewall||0);const t=D(e.zone),n=i.get(t)||{x:(Math.random()-.5)*a*2,y:(Math.random()-.5)*a*2,z:0},s=a*(.12+.45*Math.random()),o=Math.random()*Math.PI*2;L(e,{x:n.x+Math.cos(o)*s,y:n.y+Math.sin(o)*s,z:(M[e.kind]??0)+18*(Math.random()-.5)})}),e&&(B(n),N(null))}catch(t){}finally{e&&W(!1)}})(),()=>{e=!1}},[U]),r.useEffect(()=>{const e=F.current;if(e){try{const t=e.d3Force("charge");t&&t.strength(-48)}catch(t){}try{const t=e.d3Force("link");t&&t.distance(e=>{try{const t=e.source||{},n=e.target||{},s=D(t.zone),o=D(n.zone),r=String(t.kind||"").toLowerCase(),i=String(n.kind||"").toLowerCase();if(0===s&&"firewall"===r||0===o&&"firewall"===i)return 52;const a="physical"===String(e.type||"").toLowerCase()?90:130,l=["host","server","hub"],d=["router","switch","l3switch","switchrouter","layer3"];return l.includes(r)&&d.includes(i)||l.includes(i)&&d.includes(r)?Math.round(1.2*a):a}catch{return 120}}).strength(e=>{try{const t=e.source||{},n=e.target||{},s=D(t.zone),o=D(n.zone),r=String(t.kind||"").toLowerCase(),i=String(n.kind||"").toLowerCase();return 0===s&&"firewall"===r||0===o&&"firewall"===i?1:.9}catch{return.85}})}catch(t){}}},[A.nodes.length,A.links.length]);const Z=r.useMemo(()=>{const e=new Set;return A.nodes.forEach(t=>{const n=D(t.zone);null===n||Number.isNaN(n)||e.add(n)}),Array.from(e).sort((e,t)=>e-t)},[A.nodes]),q=r.useMemo(()=>{const e=new Map;return Z.forEach(t=>e.set(t,0)),A.nodes.forEach(t=>{const n=D(t.zone);e.has(n)&&e.set(n,(e.get(n)||0)+1)}),e},[A.nodes,Z]),[G,H]=r.useState([]);r.useEffect(()=>{H(Z)},[Z]);const[K,Q]=r.useState("all"),[Y,J]=r.useState(null),X=r.useMemo(()=>{const e=function(e,t){if(!e||!e.nodes)return{nodes:[],links:[]};const n=new Set(t??[]);if(0===n.size)return{nodes:[],links:[]};const s=new Set(e.nodes.filter(e=>n.has(D(e.zone))).map(e=>e.id)),o=e.links.filter(e=>s.has(S(e.source))||s.has(S(e.target))),r=new Set([...s]);o.forEach(e=>{r.add(S(e.source)),r.add(S(e.target))});const i=new Set(e.nodes.filter(e=>"core"===e.kind).map(e=>e.id));i.size&&e.links.forEach(e=>{const t=S(e.source),n=S(e.target);(i.has(t)&&r.has(n)||i.has(n)&&r.has(t))&&(r.add(t),r.add(n))}),e.nodes.forEach(e=>{0===D(e.zone)&&"firewall"===String(e.kind).toLowerCase()&&r.add(e.id)});const a=e.links.filter(e=>r.has(S(e.source))&&r.has(S(e.target)));return{nodes:e.nodes.filter(e=>r.has(e.id)||n.has(D(e.zone))),links:a}}(A,G);if(!e||!e.links)return e;let t=e.links;if("all"!==K){const e="physical"===K;t=t.filter(t=>String(t.type||"").toLowerCase()===(e?"physical":"logical"))}const n=new Set;let s;return t.forEach(e=>{n.add(S(e.source)),n.add(S(e.target))}),s="all"===K?e.nodes.filter(e=>n.has(e.id)||G.includes(D(e.zone))):e.nodes.filter(e=>n.has(e.id)),{nodes:s,links:t}},[A,G,K]),ee=r.useMemo(()=>E(X.links),[X.links]),[te,ne]=r.useState(null);r.useEffect(()=>{ne(V?.id??null)},[V]);const se=r.useCallback(e=>te&&(e.id===te||ee.get(te)?.has(e.id)),[te,ee]),oe=r.useCallback(e=>te&&(S(e.source)===te||S(e.target)===te),[te]);r.useEffect(()=>{const e=t.jsxs("div",{style:{height:"78vh",borderRadius:16,background:"linear-gradient(180deg, rgba(128,90,213,0.12), rgba(99,102,241,0.10))",padding:12,overflow:"auto",border:"1px solid rgba(124,58,237,0.25)",boxShadow:"0 6px 20px rgba(91,76,155,0.18)"},children:[t.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",marginBottom:10},children:[t.jsx("h2",{style:{fontSize:13,fontWeight:700,color:"#3b2c6b",margin:0},children:"Node"}),V&&t.jsxs("span",{style:{fontSize:11,color:"#6d4dd6",background:"rgba(109,77,214,0.12)",padding:"2px 8px",borderRadius:999},children:["Zone ",String(D(V.zone))]})]}),V?t.jsx("div",{style:{background:"rgba(255,255,255,0.6)",border:"1px solid rgba(124,58,237,0.18)",borderRadius:12,padding:10},children:t.jsx("table",{style:{width:"100%",fontSize:12,borderCollapse:"collapse"},children:t.jsxs("tbody",{children:[["label","kind","ip","subnet","zone","id"].map(e=>t.jsxs("tr",{style:{borderBottom:"1px solid rgba(124,58,237,0.12)"},children:[t.jsx("td",{style:{padding:"6px 4px",fontWeight:600,color:"#6553a7"},children:e}),t.jsx("td",{style:{padding:"6px 4px",textAlign:"right",fontFamily:'ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace',color:"#2a2050",wordBreak:"break-all"},children:String(V[e]??"")})]},e)),t.jsxs("tr",{children:[t.jsx("td",{style:{padding:"6px 4px",fontWeight:600,color:"#6553a7"},children:"이웃연결수"}),t.jsx("td",{style:{padding:"6px 4px",textAlign:"right",fontFamily:'ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace',color:"#2a2050"},children:ee.get(V.id)?.size??0})]})]})})}):t.jsx("div",{style:{color:"#5e5a7f",fontSize:12},children:"노드를 클릭하면 상세 정보가 표시됩니다."})]});o?.(e)},[V,o,ee]);const re=r.useMemo(()=>({torus:new u(7,1.6,16,32),cone:new c(4.2,9,10),cylinder:new i(4.2,4.2,8,18),box:new d(8.2,2.6,6.2),l3top:new i(2.8,2.8,2.2,16),sphere:new a(3,16,16),octa:new l(4.2),led:new a(.7,8,8),hit:new a(7,8,8),dashUnit:new i(1,1,1,10)}),[]),ie=r.useMemo(()=>({base:new Map,highlight:new h({color:16767609,metalness:.25,roughness:.72}),dim:new h({color:3293269,metalness:.25,roughness:.72}),ledUp:new f({color:65433}),ledDown:new f({color:16724821}),hit:new f({opacity:0,transparent:!0,depthWrite:!1}),dashedBase:new h({color:8891132,metalness:.15,roughness:.6,transparent:!0,opacity:.98}),dashedInc:new h({color:3829730,metalness:.2,roughness:.55,transparent:!0,opacity:1})}),[]),ae=r.useCallback(e=>{let t=ie.base.get(e);return t||(t=new h({color:new p(e),metalness:.25,roughness:.72}),ie.base.set(e,t)),t},[ie]),le=r.useMemo(()=>({dashed:new g({color:8891132,dashSize:2.2,gapSize:2.2,transparent:!0,opacity:.95}),dashedInc:new g({color:3829730,dashSize:4.4,gapSize:3.2,transparent:!0,opacity:1}),basic:new f({color:11123199}),basicInc:new f({color:3829730})}),[]),de=r.useCallback(e=>{const t=new b,n=e.color||"#a0b4ff",s=te?se(e)?ie.highlight:ie.dim:ae(n);let o;if("core"===e.kind)o=new x(re.torus,s);else if("firewall"===e.kind)o=new x(re.cone,s);else if("router"===e.kind)o=new x(re.cylinder,s);else if("switch"===e.kind||"l2switch"===e.kind)o=new x(re.box,s);else if("l3switch"===e.kind||"switchrouter"===e.kind||"layer3"===e.kind){const e=new x(re.box,s),t=new x(re.l3top,s);t.position.y=2.6;const n=new b;n.add(e),n.add(t),o=n}else o="hub"===e.kind?new x(re.octa,s):new x(re.sphere,s);const r=P(e);o.scale.set(r,r,r),o.castShadow=!0,o.receiveShadow=!0,t.add(o);const i=new x(re.led,"up"===e.status?ie.ledUp:ie.ledDown);i.position.set(0,"core"===e.kind?8:6*r*.9,0),t.add(i);const a=new x(re.hit,ie.hit);return a.name="hit-proxy",t.add(a),t},[te,ae,se,ie,re]),ce=r.useCallback(e=>"logical"===String(e.type||"").toLowerCase(),[]),ue=r.useCallback(e=>"physical"===String(e.type||"").toLowerCase(),[]),he=r.useCallback(e=>ce(e)?0:te&&oe(e)?I:_,[ce,te,oe]),fe=r.useCallback(e=>ce(e)?te&&oe(e)?le.dashedInc:le.dashed:te&&oe(e)?le.basicInc:le.basic,[ce,te,oe,le]),pe=r.useCallback(e=>te?oe(e)?"#3a6fe2":ce(e)?"#87aafc":"#7f90b8":ce(e)?"#87aafc":"#a9b9ff",[te,oe,ce]),ge=r.useCallback(e=>ce(e)?0:te?oe(e)?4:0:2,[ce,te,oe]),be=r.useCallback(e=>ue(e)?.006:0,[ue]),xe=r.useCallback(e=>ue(e)?.05:.16,[ue]),ye=r.useCallback(e=>(C(S(e.source))+C(S(e.target)))%628/100,[]),we=r.useCallback(e=>{if(!ce(e))return;const t=new b;return t.userData={type:"logical-dashed",link:e,dashes:[]},t},[ce]),me=r.useCallback((e,t)=>{const n=z(e.source),s=z(e.target),o="object"==typeof e.source&&e.source||X.nodes.find(e=>e.id===n)||A.nodes.find(e=>e.id===n),r="object"==typeof e.target&&e.target||X.nodes.find(e=>e.id===s)||A.nodes.find(e=>e.id===s);if(!o||!r)return void(t.visible=!1);if([o.x,o.y,o.z,r.x,r.y,r.z].some(e=>"number"!=typeof e))return void(t.visible=!1);const i=function(e,t,n,s){const o=(new y).subVectors(t,e),r=o.length()||1,i=(new y).addVectors(e,t).multiplyScalar(.5),a=Math.abs(o.x)<.9?new y(1,0,0):new y(0,1,0),l=(new y).crossVectors(o,a).normalize();l.applyAxisAngle(o.clone().normalize(),s);const d=n*r*2,c=l.multiplyScalar(d).add(i);return new w(e,c,t)}(new y(o.x,o.y,o.z),new y(r.x,r.y,r.z),xe(e),(C(n)+C(s))%628/100),a=Math.max(1e-6,i.getLength()),l=T(o),d=T(r);if(a<=1.05*(l+d))return void(t.visible=!1);const c=Math.min(.49,l/a),u=1-Math.min(.49,d/a);!function(e,t,n,s,o){e.userData.dashes||(e.userData.dashes=[]);const r=e.userData.dashes;for(;r.length<16;){const t=new x(n,s);t.castShadow=!1,t.receiveShadow=!1,r.push(t),e.add(t)}for(;r.length>16;){const t=r.pop();e.remove(t)}e.userData.matBase=s,e.userData.matInc=o}(t,0,re.dashUnit,ie.dashedBase,ie.dashedInc);const h=!(!te||n!==te&&s!==te),f=h?2.8:1.35,p=h?t.userData.matInc:t.userData.matBase,g=Math.min(.6*f,1.2),b=u-c;if(b<=1e-4)t.visible=!1;else{for(let e=0;e<16;e++){const n=c+e/16*b,s=c+Math.min(u,(e+.58)/16*b),o=Math.max(c,n),r=Math.min(u,s),a=t.userData.dashes[e];if(!a||r-o<=1e-4){a&&(a.visible=!1);continue}const l=i.getPoint(o),d=i.getPoint(r),h=(new y).subVectors(d,l);if(h.length()<.001){a.visible=!1;continue}h.normalize();const x=l.clone().addScaledVector(h,g),w=d.clone().addScaledVector(h,-g);a.material=p,a.renderOrder=2,a.material&&(a.material.depthTest=!0,a.material.depthWrite=!1,a.material.needsUpdate=!0),R(a,x,w,Math.max(.18,f))}t.visible=!0}},[X.nodes,A.nodes,re.dashUnit,ie.dashedBase,ie.dashedInc,te,xe]),ke=r.useCallback(()=>{const e=F.current?.scene?.();e&&e.traverse(e=>{"logical-dashed"===e.userData?.type&&e.userData.link&&(me(e.userData.link,e),e.visible=!0)})},[me]);r.useEffect(()=>{ke()},[te,X.links,ke]);const ve=r.useCallback(e=>{const t=X.nodes.find(t=>t.id===e)||A.nodes.find(t=>t.id===e);if(!t)return;N(t);const n=1+300/Math.hypot(t.x||1,t.y||1,t.z||1);F.current?.cameraPosition({x:(t.x||1)*n,y:(t.y||1)*n,z:640},t,900)},[X.nodes,A.nodes]);r.useEffect(()=>{const e=setTimeout(()=>{const e=A.nodes.find(e=>"core"===e.kind);e&&ve(e.id)},300);return()=>clearTimeout(e)},[A.nodes,ve]);const je=r.useCallback(e=>{N(t=>t&&D(t.zone)===e?null:t),H(t=>{const n=new Set(t);return n.has(e)?n.delete(e):n.add(e),Array.from(n).sort((e,t)=>e-t)})},[]),Se=r.useCallback(()=>H(Z),[Z]),ze=r.useCallback(()=>H([]),[]),Ce=r.useRef(!1);r.useEffect(()=>{const e=F.current;if(!e)return;const t=e.controls&&e.controls(),n=e.renderer&&e.renderer();if(!t||!n)return;t.enablePan=!0,t.screenSpacePanning=!0,t.listenToKeyEvents&&t.listenToKeyEvents(window),t.keyPanSpeed=8;const s=n.domElement;let o=!1;const r=()=>{s&&(s.style.cursor=o?"grab":"")},i=e=>{"Space"!==e.code&&" "!==e.key||o||(o=!0,Ce.current=!0,r(),t.mouseButtons.LEFT=2,e.preventDefault())},a=e=>{"Space"!==e.code&&" "!==e.key||(o=!1,Ce.current=!1,r(),t.mouseButtons.LEFT=0)},l=()=>{o&&s&&(s.style.cursor="grabbing")},d=()=>{o&&s&&(s.style.cursor="grab")};return window.addEventListener("keydown",i,{passive:!1}),window.addEventListener("keyup",a),s.addEventListener("mousedown",l),window.addEventListener("mouseup",d),t.mouseButtons.RIGHT=2,()=>{window.removeEventListener("keydown",i),window.removeEventListener("keyup",a),s.removeEventListener("mousedown",l),window.removeEventListener("mouseup",d)}},[]);const[Ee,Me]=r.useState(null),[_e,Ie]=r.useState([]),Le=r.useRef(null),[De,Re]=r.useState({width:0,height:0}),Pe=r.useCallback(()=>{const e=Le.current;if(e)try{Re({width:e.clientWidth||0,height:e.clientHeight||0})}catch{}},[]);return r.useEffect(()=>{const e=Le.current;if(!e)return;let t;if(Pe(),"undefined"!=typeof ResizeObserver){t=new ResizeObserver(Pe);try{t.observe(e)}catch{}}else window.addEventListener("resize",Pe);return()=>{try{t&&e&&t.unobserve(e)}catch{}window.removeEventListener("resize",Pe)}},[Pe]),t.jsxs("div",{style:{display:"flex",width:"100%",height:"calc(100vh - 120px)",gap:"24px",padding:"16px"},children:[t.jsx(n,{sx:{width:280,flex:"none",bgcolor:"#f0edfd",color:"#000",border:"1px solid #d0c9f0",boxShadow:"0 2px 8px rgba(0,0,0,0.1)",borderRadius:"20px",mr:"8px",height:"100%",display:"flex",flexDirection:"column"},children:t.jsxs(s,{sx:{p:2,display:"flex",flexDirection:"column",flex:1},children:[t.jsx("div",{style:{height:1,background:"rgba(0,0,0,0.10)",margin:"6px 0 10px"}}),t.jsx("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",marginBottom:8},children:t.jsx("span",{style:{fontSize:13,color:"#000000ff"},children:"Link Type"})}),t.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:6,marginBottom:14},children:[t.jsx("button",{onClick:()=>{Q("physical")},style:{padding:"7px 0",borderRadius:8,fontSize:12,background:"physical"===U||"physical"===K?"#2563ebcc":"rgba(240,237,253, 1)",color:"#000000ff",border:"1px solid",cursor:"pointer"},title:"물리 링크만 보기",children:"Physical"}),t.jsx("button",{onClick:()=>{Q("logical")},style:{padding:"7px 0",borderRadius:8,fontSize:12,background:"logical"===U||"logical"===K?"#2563ebcc":"rgba(240,237,253, 1)",color:"#000000ff",border:"1px solid",cursor:"pointer"},title:"논리 링크(점선)만 보기",children:"Logical"})]}),t.jsx("div",{style:{display:"flex",gap:8,marginBottom:12},children:t.jsx("button",{onClick:()=>{N(null),H(Z),Q("all");const e=A.nodes.find(e=>"core"===e.kind);if(e&&F.current){const t=640,n=1+150/Math.hypot(e.x||1,e.y||1,e.z||1);F.current.cameraPosition({x:(e.x||1)*n,y:(e.y||1)*n,z:t},e,800)}},style:{flex:1,padding:"7px 0",borderRadius:8,fontSize:13,background:"#39306b",color:"#fff",border:"1px solid #3b82f6",cursor:"pointer"},children:"뷰 초기화"})}),t.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8,margin:"8px 0 10px"},children:[t.jsx("div",{style:{width:12,height:12,borderRadius:6,background:"#60a5fa",boxShadow:"0 0 4px #60a5fa"}}),t.jsx("span",{style:{fontSize:15,color:"#000000ff",fontWeight:600},children:"Zones"})]}),t.jsx("div",{style:{flex:1,overflowY:"auto",paddingRight:4},children:Z.map(e=>{const n=G.includes(e),s=q.get(e)||0;return t.jsxs("div",{style:{border:"1px solid "+(n?"#3b82f6":"#e5e7eb22"),borderRadius:8,marginBottom:8,background:"rgba(255,255,255,0.05)"},children:[t.jsx("button",{onClick:()=>J(e),style:{width:"100%",textAlign:"left",padding:"10px 14px",fontSize:13,color:"#000000ff",fontWeight:n?600:400,background:"transparent",border:"none",cursor:"pointer"},children:t.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[t.jsxs("span",{children:["Zone ",e]}),t.jsx("span",{style:{fontSize:11,padding:"2px 8px",borderRadius:999,background:"rgba(255,255,255,0.12)",color:"#000000ff"},children:s})]})}),t.jsx("div",{style:{display:"flex",gap:6,padding:"0 10px 10px"},children:t.jsx("button",{onClick:()=>J(e),title:"존 상세 보기",style:{flex:1,padding:"6px 0",borderRadius:8,fontSize:12,background:"#39306b",color:"#fff",border:"1px solid #3b82f6",cursor:"pointer"},children:"Details"})})]},e)})}),t.jsxs("div",{style:{marginTop:"auto",paddingTop:18},children:[t.jsx("div",{style:{marginBottom:10,fontSize:13,color:"#000000ff",fontWeight:600},children:"Zone Filter"}),t.jsx("form",{style:{display:"flex",flexDirection:"column",gap:6,marginBottom:10},children:Z.map(e=>t.jsxs("label",{style:{display:"flex",alignItems:"center",gap:8,fontSize:13,color:"#000000ff",cursor:"pointer"},children:[t.jsx("input",{type:"checkbox",checked:G.includes(e),onChange:()=>je(e),style:{accentColor:"#2563eb",width:16,height:16,margin:0}}),t.jsxs("span",{children:["Zone ",e," ",t.jsxs("span",{style:{fontSize:11,marginLeft:4,color:"#000000ff"},children:["(",q.get(e)||0,")"]})]})]},e))}),t.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8,marginBottom:10},children:[t.jsx("button",{onClick:Se,style:{flex:1,padding:"8px 0",borderRadius:8,fontSize:13,background:"rgba(255,255,255,0.10)",color:"#F0EDFD",border:"1px solid rgba(255,255,255,0.10)",cursor:"pointer"},children:"All"}),t.jsx("button",{onClick:ze,style:{flex:1,padding:"8px 0",borderRadius:8,fontSize:13,background:"rgba(255,255,255,0.10)",color:"#F0EDFD",border:"1px solid rgba(255,255,255,0.10)",cursor:"pointer"},children:"None"})]}),t.jsxs("div",{style:{marginTop:4,fontSize:12,color:"#000000ff"},children:[X.nodes.length," nodes • ",X.links.length," links"]})]})]})}),t.jsxs("main",{ref:Le,style:{flex:1,height:"100%",position:"relative",background:"#856affff",overflow:"hidden",borderRadius:"20px",boxShadow:"0 2px 8px rgba(57, 48, 107, 0.07)",marginRight:"8px"},children:[t.jsx(r.Suspense,{fallback:t.jsx("div",{style:{position:"absolute",left:0,top:0,right:0,bottom:0,display:"flex",alignItems:"center",justifyContent:"center"},children:t.jsx("div",{style:{background:"rgba(0,0,0,0.6)",color:"#fff",padding:"12px 18px",borderRadius:8,backdropFilter:"blur(4px)"},children:"Loading Graph..."})}),children:t.jsx(m,{ref:F,graphData:X,backgroundColor:"#F0EDFD",width:De.width,height:De.height,nodeThreeObject:de,nodeThreeObjectExtend:!0,linkThreeObject:we,linkThreeObjectExtend:!1,linkWidth:he,linkColor:pe,linkMaterial:fe,linkDirectionalParticles:ge,linkDirectionalParticleSpeed:be,linkDirectionalParticleWidth:2,linkCurvature:xe,linkCurveRotation:ye,linkDirectionalArrowLength:6,linkDirectionalArrowRelPos:.58,onEngineTick:r.useCallback(()=>{const e=F.current?.scene?.();e&&e.traverse(e=>{"logical-dashed"===e.userData?.type&&e.userData.link&&me(e.userData.link,e)})},[me]),onEngineStop:r.useCallback(()=>{ke()},[ke]),onLinkUpdate:r.useCallback((e,t)=>{try{t&&t.computeLineDistances&&t.computeLineDistances()}catch{}if("logical"===String(e.type||"").toLowerCase()){const t=F.current?.scene?.();if(!t)return;t.traverse(t=>{"logical-dashed"===t.userData?.type&&t.userData.link===e&&me(e,t)})}},[me]),onNodeClick:r.useCallback(e=>{if(N(e),e){const t=ee.get(e.id)||new Set,n=Array.from(t).map(e=>{const t=X.nodes.find(t=>t.id===e);return t?.ip}).filter(e=>e),s=X.links.filter(t=>{const n="object"==typeof t.source?t.source.id:t.source,s="object"==typeof t.target?t.target.id:t.target;return n===e.id||s===e.id}).map(e=>{const t="object"==typeof e.source?e.source.id:e.source,n="object"==typeof e.target?e.target.id:e.target,s=X.nodes.find(e=>e.id===t)||A.nodes.find(e=>e.id===t),o=X.nodes.find(e=>e.id===n)||A.nodes.find(e=>e.id===n);return{src_IP:s?{id:s.id,ip:s.ip,__labels:[s.kind],__id:s.id,index:s.zone}:null,dst_IP:o?{id:o.id,ip:o.ip,__labels:[o.kind],__id:o.id,index:o.zone}:null,edge:{sourceIP:t,targetIP:n,type:e.type,count:e.count}}}),o={message:`노드 선택: ${e.label||e.id}`,nodeInfo:{kind:e.kind,zone:e.zone,ip:e.ip},connectedCount:t.size,connectedIps:n,dbInfo:s};Ie([o])}},[ee,X.nodes,X.links,A.nodes]),onBackgroundClick:r.useCallback(()=>{N(null),Ie([])},[]),enableNodeDrag:!1,showNavInfo:!1,warmupTicks:10,cooldownTicks:30,d3AlphaDecay:.05,d3VelocityDecay:.4})}),O&&t.jsx("div",{style:{position:"absolute",left:0,top:0,right:0,bottom:0,display:"flex",alignItems:"center",justifyContent:"center",pointerEvents:"none"},children:t.jsx("div",{style:{background:"rgba(0,0,0,0.6)",color:"#fff",padding:"12px 18px",borderRadius:8,backdropFilter:"blur(4px)"},children:"Loading…"})}),r.useEffect(()=>{const e=()=>{try{F.current&&F.current.zoomToFit(600,40)}catch{}};(X.nodes?.length||X.links?.length)&&requestAnimationFrame(e);const t=Le.current;let n;return t&&"undefined"!=typeof ResizeObserver?(n=new ResizeObserver(()=>requestAnimationFrame(e)),n.observe(t)):window.addEventListener("resize",e),()=>{n&&t&&n.unobserve(t),window.removeEventListener("resize",e)}},[X]),null!==Y&&t.jsxs("div",{style:{position:"absolute",inset:0,display:"flex",alignItems:"center",justifyContent:"center",zIndex:60},children:[t.jsx("div",{onClick:()=>J(null),style:{position:"absolute",inset:0,background:"rgba(0,0,0,0.6)"}}),t.jsx("div",{onClick:e=>e.stopPropagation(),style:{position:"relative",width:"calc(100% - 48px)",height:"calc(100% - 48px)",margin:"24px",background:"#0b0f14",borderRadius:12,boxShadow:"0 12px 40px rgba(0,0,0,0.8)",overflow:"hidden",border:"1px solid rgba(255,255,255,0.04)"},children:t.jsx(r.Suspense,{fallback:t.jsx("div",{style:{color:"#fff",padding:20},children:"Loading..."}),children:t.jsx(k,{zone:Y,onBack:()=>J(null),onInspectorChange:o,setEventLogs:Ie})})})]})]}),t.jsx(r.Suspense,{fallback:t.jsx("div",{style:{width:280}}),children:t.jsx(v,{eventLogs:_e})})]})});export{F as default};
