import{j as e,C as t,e as r,T as n}from"./mui-vendor-DRsyA_VI.js";import{a as s}from"./react-vendor-CP5_hn_0.js";import{h as i,V as o,F as a,G as l,g as d,L as c,i as u,P as p,b as h,c as y,E as g,j as x,d as f,e as b,f as m,k as v}from"./three-vendor-C8Ar5e6p.js";import"./chart-vendor-BJu2iTGG.js";const j=s.memo(({eventLogs:s=[]})=>e.jsx(t,{elevation:0,sx:{minWidth:350,width:300,bgcolor:"#f0edfd",color:"#000",border:"1px solid #d0c9f0",borderRadius:"20px",display:"flex",flexDirection:"column",flexShrink:0,height:"100%"},children:e.jsxs(r,{sx:{p:2,display:"flex",flexDirection:"column",gap:2,flex:1,minHeight:0},children:[e.jsx(n,{variant:"subtitle1",sx:{fontWeight:700,color:"#39306b",mb:1},children:"이벤트 로그"}),e.jsx("div",{style:{flex:1,overflowY:"auto",minHeight:0},children:0===s.length?e.jsx("div",{style:{color:"#666",fontSize:"14px",padding:"10px"},children:"노드를 클릭하면 이벤트 로그가 표시됩니다."}):s.map((s,i)=>e.jsxs("div",{style:{padding:"10px",marginBottom:"8px",background:"rgba(57, 48, 107, 0.1)",borderRadius:"8px",fontSize:"13px",color:"#333"},children:[s.message&&e.jsx("div",{style:{fontWeight:600,marginBottom:"4px",color:"#222"},children:s.message}),s.nodeInfo&&e.jsxs("div",{style:{fontSize:"11px",color:"#666",marginTop:"4px"},children:["Layer: ",s.nodeInfo.layer," | Type: ",s.nodeInfo.type]}),void 0!==s.connectedCount&&e.jsxs("div",{style:{marginTop:"8px",marginBottom:"8px",color:"#222"},children:["연결된 노드 개수: ",s.connectedCount,Array.isArray(s.connectedIps)&&s.connectedIps.length>0&&e.jsxs("details",{style:{marginTop:"4px",color:"#222"},children:[e.jsx("summary",{style:{cursor:"pointer",color:"#1976d2",fontWeight:"bold"},children:"연결된 노드 IP 목록 보기"}),e.jsx("ul",{style:{margin:0,paddingLeft:16},children:s.connectedIps.map((t,r)=>e.jsx("li",{style:{color:"#222"},children:t},t+r))})]})]}),Array.isArray(s.dbInfo)&&s.dbInfo.length>0&&s.dbInfo.map((s,i)=>e.jsx(t,{elevation:0,sx:{bgcolor:"rgba(255,255,255,0.6)",border:"1px solid rgba(124,58,237,0.18)",borderRadius:2,mt:1},children:e.jsx(r,{sx:{py:1.25,px:1.5},children:(()=>{const t=String(s?.src_IP?.__labels?.[0]||"").toLowerCase(),r="logical"===t;return"physical"===t?e.jsxs(e.Fragment,{children:[s.src_IP&&e.jsxs("div",{style:{marginBottom:"12px"},children:[e.jsx(n,{variant:"subtitle2",sx:{color:"#3b2c6b",fontWeight:700,mb:.5},children:"Src Node"}),e.jsx("ul",{style:{margin:0,paddingLeft:16},children:[["name",s.src_IP.name],["type",s.src_IP.type],["ip",s.src_IP.ip],["subnet",s.src_IP.subnet],["dns",s.src_IP.dns],["gateway",s.src_IP.gateway]].filter(([,e])=>null!=e&&""!==e).map(([t,r])=>e.jsxs("li",{style:{color:"#2a2050"},children:[e.jsxs("b",{style:{color:"#6553a7"},children:[t,":"]})," ",String(r)]},t))})]}),s.dst_IP&&e.jsxs("div",{style:{marginBottom:"12px"},children:[e.jsx(n,{variant:"subtitle2",sx:{color:"#3b2c6b",fontWeight:700,mb:.5},children:"Dst Node"}),e.jsx("ul",{style:{margin:0,paddingLeft:16},children:[["name",s.dst_IP.name],["description",s.dst_IP.description],["cve",s.dst_IP.cve]].filter(([,e])=>null!=e&&""!==e).map(([t,r])=>e.jsxs("li",{style:{color:"#2a2050"},children:[e.jsxs("b",{style:{color:"#6553a7"},children:[t,":"]})," ",String(r)]},t))})]}),s.edge&&e.jsxs("div",{children:[e.jsx(n,{variant:"subtitle2",sx:{color:"#3b2c6b",fontWeight:700,mb:.5},children:"Edge Info"}),e.jsx("ul",{style:{margin:0,paddingLeft:16},children:[["rel",s.edge.rel||s.edge.kind],["SrcID",s.edge.sourceIP],["TargetID",s.edge.targetIP]].map(([t,r])=>{const n=Array.isArray(r)?r.join(", "):String(r);return e.jsxs("li",{style:{color:"#2a2050"},children:[e.jsxs("b",{style:{color:"#6553a7"},children:[t,":"]})," ",n]},t)})})]})]}):r?e.jsxs(e.Fragment,{children:[s.src_IP&&e.jsxs("div",{style:{marginBottom:"12px"},children:[e.jsx(n,{variant:"subtitle2",sx:{color:"#3b2c6b",fontWeight:700,mb:.5},children:"Src Node"}),e.jsx("ul",{style:{margin:0,paddingLeft:16},children:[["name",s.src_IP.name],["description",s.src_IP.description],["cve",s.src_IP.cve]].filter(([,e])=>null!=e&&""!==e).map(([t,r])=>{const n=Array.isArray(r)?r.join(", "):String(r);return e.jsxs("li",{style:{color:"#2a2050"},children:[e.jsxs("b",{style:{color:"#6553a7"},children:[t,":"]})," ",n]},t)})})]}),s.dst_IP&&e.jsxs("div",{style:{marginBottom:"12px"},children:[e.jsx(n,{variant:"subtitle2",sx:{color:"#3b2c6b",fontWeight:700,mb:.5},children:"Dst Node"}),e.jsx("ul",{style:{margin:0,paddingLeft:16},children:(void 0!==s.dst_IP.key||void 0!==s.dst_IP.value?[["id",s.dst_IP.id],["key",s.dst_IP.key],["value",s.dst_IP.value]]:[["name",s.dst_IP.name],["description",s.dst_IP.description],["cve",s.dst_IP.cve]]).filter(([,e])=>null!=e&&""!==e).map(([t,r])=>{const n=Array.isArray(r)?r.join(", "):String(r);return e.jsxs("li",{style:{color:"#2a2050"},children:[e.jsxs("b",{style:{color:"#6553a7"},children:[t,":"]})," ",n]},t)})})]}),s.edge&&e.jsxs("div",{children:[e.jsx(n,{variant:"subtitle2",sx:{color:"#3b2c6b",fontWeight:700,mb:.5},children:"Edge Info"}),e.jsx("ul",{style:{margin:0,paddingLeft:16},children:[["rel",s.edge.rel||s.edge.kind],["SrcID",s.edge.sourceIP],["TargetID",s.edge.targetIP]].map(([t,r])=>{const n=Array.isArray(r)?r.join(", "):String(r);return e.jsxs("li",{style:{color:"#2a2050"},children:[e.jsxs("b",{style:{color:"#6553a7"},children:[t,":"]})," ",n]},t)})})]})]}):e.jsxs(e.Fragment,{children:[s.src_IP&&e.jsxs("div",{style:{marginBottom:"12px"},children:[e.jsx(n,{variant:"subtitle2",sx:{color:"#3b2c6b",fontWeight:700,mb:.5},children:"Src Node"}),e.jsx("ul",{style:{margin:0,paddingLeft:16},children:[["id",s.src_IP.id]].map(([t,r])=>e.jsxs("li",{style:{color:"#2a2050"},children:[e.jsxs("b",{style:{color:"#6553a7"},children:[t,":"]})," ",String(r)]},t))})]}),s.dst_IP&&e.jsxs("div",{style:{marginBottom:"12px"},children:[e.jsx(n,{variant:"subtitle2",sx:{color:"#3b2c6b",fontWeight:700,mb:.5},children:"Dst Node"}),e.jsx("ul",{style:{margin:0,paddingLeft:16},children:[["id",s.dst_IP.id]].map(([t,r])=>{const n=Array.isArray(r)?r.join(", "):String(r);return e.jsxs("li",{style:{color:"#2a2050"},children:[e.jsxs("b",{style:{color:"#6553a7"},children:[t,":"]})," ",n]},t)})})]}),s.edge&&e.jsxs("div",{children:[e.jsx(n,{variant:"subtitle2",sx:{color:"#3b2c6b",fontWeight:700,mb:.5},children:"Edge Info"}),e.jsx("ul",{style:{margin:0,paddingLeft:16},children:[["rel",s.edge.rel||s.edge.kind],["SrcID",s.edge.sourceIP],["TargetID",s.edge.targetIP]].map(([t,r])=>{const n=Array.isArray(r)?r.join(", "):String(r);return e.jsxs("li",{style:{color:"#2a2050"},children:[e.jsxs("b",{style:{color:"#6553a7"},children:[t,":"]})," ",n]},t)})})]})]})})()})},i))]},i))})]})}));j.displayName="InternalLog";var w={};const _=["up","down","unknown"],k={physical:"#3BA3FF",logical:"#9B6BFF",persona:"#FF9E3B"},I=800,S=-600,E=0,P=600,C=2e3,A=1400,L={CONNECTS_TO:"#A0AEC0",CONNECTED:"#A0AEC0",HOSTS:"#60A5FA",USES:"#F59E0B",IN_SUBNET:"#93C5FD",IN_VLAN:"#C084FC",MEMBER_OF:"#FBBF24"},z="undefined"!=typeof process&&w&&w.REACT_APP_API_BASE||"http://localhost:8000";function D(e){if(!e)return[];const t=new Set,r=/CVE-\d{4}-\d+/gi,n=e=>{var n;(n=e,null==n?[]:Array.isArray(n)?n:[n]).forEach(e=>{const n="string"==typeof e?e:(s=e)&&"object"==typeof s&&(s.cve||s.CVE||s.id||s.value||s.name||s.key||s.description)||"";var s;const i=String(n||"").trim();if(!i)return;const o=i.match(r);o?o.forEach(e=>t.add(e.toUpperCase())):i.toUpperCase().includes("CVE")&&t.add(i.toUpperCase())})};return n(e.cve),n(e.CVE),n(e.cves),n(e.CVEs),n(e.cve_list),n(e.vulns),n(e.vulnerabilities),n(e.vulnerability),n(e.tags),n(e.description),Array.from(t)}function F(e){const t=(e.__labels||[]).map(e=>String(e).toLowerCase());let r=e.layer&&String(e.layer).toLowerCase()||(t.includes("persona")?"persona":t.includes("logical")||t.includes("service")||t.includes("subnet")||t.includes("vlan")?"logical":(t.includes("physical")||t.includes("device")||t.includes("host"),"physical")),n=(e.type||t[0]||"device").toString().toLowerCase(),s=e.label||e.hostname||e.name||e.user_name||e.service_name||e.subnet||e.ip||e.id;return s||void 0===e.vlan||(s=`VLAN-${e.vlan}`),{id:e.id,layer:r,type:n,label:s||String(e.id||""),status:e.status||"up",severity:"number"==typeof e.severity?e.severity:0,ip:e.ip,hostname:e.hostname,os:e.os,subnet:e.subnet,dns:e.dns,gateway:e.gateway,description:e.description,value:e.value,key:e.key,cve:e.cve,cves:e.cves,cve_list:e.cve_list,vulns:e.vulns,vulnerabilities:e.vulnerabilities,service_name:e.service_name,proto:e.proto,port:e.port,vlan:e.vlan,user_name:e.user_name,role:e.role,dept:e.dept,device_ids:e.device_ids||[],tags:e.tags||[],x:(Math.random()-.5)*C*.9,y:(Math.random()-.5)*A*.9,z:"persona"===r?P:"logical"===r?E:S}}function B(e){if(!e)return null;let t=e.kind||e.rel||e.type||"CONNECTS_TO";return"CONNECTED"===t&&(t="CONNECTS_TO"),{source:e.sourceIP,target:e.targetIP,kind:t,assumed:Boolean(e.assumed),confidence:"number"==typeof e.confidence?e.confidence:void 0,__sid:e.sourceIP,__tid:e.targetIP}}function R({selected:t,adj:r,visible:n,byId:s,onClearSelection:i,onResetView:o}){return t?e.jsxs(e.Fragment,{children:[e.jsxs("div",{style:{padding:16,borderBottom:"1px solid rgba(255,255,255,0.1)"},children:[e.jsx("div",{style:{fontSize:14,fontWeight:600,marginBottom:12,color:"#fff"},children:"기본 정보"}),e.jsxs("div",{style:{display:"grid",rowGap:6,color:"#e5e7eb",fontSize:13},children:[e.jsxs("div",{children:[e.jsx("b",{children:"ID:"})," ",e.jsx("span",{style:{wordBreak:"break-all"},children:t.id})]}),e.jsxs("div",{children:[e.jsx("b",{children:"Layer:"})," ",t.layer]}),e.jsxs("div",{children:[e.jsx("b",{children:"Type:"})," ",t.type]}),e.jsxs("div",{children:[e.jsx("b",{children:"Label:"})," ",t.label]}),e.jsxs("div",{children:[e.jsx("b",{children:"Status:"})," ",t.status]}),e.jsxs("div",{children:[e.jsx("b",{children:"Severity:"})," ",t.severity]}),Array.isArray(t.tags)&&t.tags.length>0&&e.jsxs("div",{children:[e.jsx("b",{children:"Tags:"})," ",t.tags.join(", ")]})]})]}),e.jsx(M,{selectedId:t.id,visible:n,adj:r,byId:s}),e.jsxs("div",{style:{padding:12,borderTop:"1px solid rgba(255,255,255,0.1)",display:"flex",gap:8},children:[e.jsx("button",{onClick:i,style:{padding:"4px 8px",background:"#374151",color:"#fff",border:"none",borderRadius:6},children:"선택 해제"}),e.jsx("button",{onClick:o,style:{padding:"4px 8px",background:"#374151",color:"#fff",border:"none",borderRadius:6},children:"전체 보기"})]})]}):e.jsxs("div",{style:{padding:16,color:"#d1d5db",fontSize:14},children:[e.jsx("div",{style:{fontWeight:600,marginBottom:8},children:"선택된 노드가 없습니다"}),"노드를 클릭하면 상세 정보와 연결 리스트가 여기에 표시됩니다."]})}function M({selectedId:t,visible:r,byId:n,adj:s}){return e.jsxs("div",{style:{padding:16,flex:1,overflow:"auto"},children:[e.jsx("div",{style:{fontSize:14,fontWeight:600,marginBottom:8,color:"#fff"},children:"동일 레이어 연결"}),e.jsx(T,{listType:"same",selectedId:t,visible:r,byId:n,adj:s}),e.jsx("div",{style:{height:12}}),e.jsx("div",{style:{fontSize:14,fontWeight:600,marginBottom:8,color:"#fff"},children:"교차 레이어 연결"}),e.jsx(T,{listType:"cross",selectedId:t,visible:r,byId:n,adj:s})]})}function T({listType:t,selectedId:r,visible:n,byId:s,adj:i}){const o=[];return r&&s[r]&&(i.get(r)||[]).forEach(e=>{const i=n.links.find(t=>{const n=t.__sid||("object"==typeof t.source?t.source.id:t.source),s=t.__tid||("object"==typeof t.target?t.target.id:t.target);return n===r&&s===e||s===r&&n===e}),a=s[e];if(!i||!a)return;const l=a.layer!==s[r].layer;("same"===t&&!l||"cross"===t&&l)&&o.push({l:i,other:a})}),o.length?e.jsx("div",{children:o.map((t,r)=>e.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",padding:"4px 0",borderBottom:"1px solid rgba(55,65,81,0.5)",fontSize:12},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8},children:[e.jsx("span",{style:{width:8,height:8,borderRadius:4,background:k[t.other.layer]}}),e.jsx("span",{style:{color:"#e5e7eb"},children:t.other.label}),e.jsxs("span",{style:{color:"#9ca3af"},children:["(",t.other.type,")"]})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8},children:[t.l.assumed&&e.jsx("span",{style:{background:"#374151",color:"#e5e7eb",padding:"2px 6px",borderRadius:4,fontSize:10},children:"assumed"}),e.jsx("span",{style:{color:"#9ca3af"},children:t.l.kind})]})]},r))}):e.jsx("div",{style:{fontSize:12,color:"#9ca3af"},children:"없음"})}function N({onNodeSelect:n=()=>{},onInspectorChange:w=()=>{}}){const M=s.useRef(),T=s.useRef(null),N=s.useRef(null),[W,O]=s.useState({width:0,height:0}),[$,V]=s.useState({nodes:[],links:[]}),[U,Y]=s.useState(!1),[X,Z]=s.useState(null),[H,q]=s.useState(!0),[G,Q]=s.useState(""),[J,K]=s.useState({physical:!0,logical:!0,persona:!0}),[ee,te]=s.useState("all"),[re,ne]=s.useState(new Set(_)),[se,ie]=s.useState([]),{byId:oe,adj:ae}=s.useMemo(()=>function(e,t){const r=Object.fromEntries(e.map(e=>[e.id,e])),n=new Map;return e.forEach(e=>n.set(e.id,new Set)),t.forEach(e=>{const t="object"==typeof e.source?e.source.id:e.source,s="object"==typeof e.target?e.target.id:e.target;n.has(t)&&n.get(t).add(s),n.has(s)&&n.get(s).add(t),e.__sid=t,e.__tid=s,e.__s=r[t],e.__t=r[s]}),{byId:r,adj:n}}($.nodes,$.links),[$]);s.useEffect(()=>{const e=M.current;if(!e)return;const t=e.controls&&e.controls();if(t){t.enableRotate=!1,t.enablePan=!1,t.enableZoom=!0;try{t.mouseButtons={LEFT:i.ROTATE,MIDDLE:i.DOLLY,RIGHT:i.PAN}}catch(n){}t.minPolarAngle=1e-6,t.maxPolarAngle=1e-6}e.cameraPosition({x:0,y:1800,z:0},{x:0,y:0,z:0},0);const r=e.scene();r.rotation.order="YXZ",r.rotation.set(0,0,0,"YXZ"),(()=>{const e=M.current?.scene?.();if(!e)return;const t=e.getObjectByName("layer-planes");t&&e.remove(t);const r=new l;r.name="layer-planes";const n=(e,t,n)=>{const s=new p(C,A,1,1),i=new h({color:t,transparent:!0,opacity:.06,depthWrite:!1}),o=new y(s,i);o.position.set(0,0,e);const a=new g(s),l=new x(a,new u({color:t,transparent:!0,opacity:.25}));l.position.set(0,0,e+.1);const d=document.createElement("canvas");d.width=512,d.height=128;const c=d.getContext("2d");c.fillStyle="rgba(0,0,0,0)",c.fillRect(0,0,512,128),c.font="40px sans-serif",c.fillStyle="#ffffff",c.textAlign="left",c.textBaseline="middle",c.fillText(n,14,64);const v=new f(d),j=new b({map:v,transparent:!0,opacity:.9,depthWrite:!1}),w=new m(j);w.scale.set(320,80,1),w.position.set(-820,A/2-80,e+.2),r.add(o),r.add(l),r.add(w)};n(S,k.physical,"Physical"),n(E,k.logical,"Logical"),n(P,k.persona,"Persona"),e.add(r)})(),(()=>{const e=M.current?.scene?.(),t=e?.getObjectByName("layer-planes");t&&(t.visible=!0)})()},[]),s.useEffect(()=>{const e=M.current;if(e){try{e.d3Force("charge")&&e.d3Force("charge").strength(0)}catch{}try{e.d3Force("link")&&e.d3Force("link").strength(()=>.05)}catch{}}},[]),s.useEffect(()=>{let e=!0;return(async()=>{try{e&&q(!0)}catch(t){}try{const t=function(e){const t=new Map,r=[];for(const a of e){const e=a.src_IP||a.n||a.source,n=a.dst_IP||a.t||a.target,s=a.edge||a.r;if(!e||!n)continue;const i=e.id,o=n.id;if(!i||!o)continue;t.has(i)||t.set(i,F(e)),t.has(o)||t.set(o,F(n));const l=B(s);l&&r.push(l)}const n=[...t.values()],s=n.filter(e=>"subnet"===e.type),i=n.filter(e=>"physical"===e.layer),o=new Map;return s.forEach((e,t)=>{const r=t/Math.max(1,s.length)*Math.PI*2;o.set(e.subnet||e.label||e.id,{cx:420*Math.cos(r),cy:420*Math.sin(r)})}),i.forEach(e=>{const t=e.subnet||e.label,r=o.get(t);r&&(e.x=r.cx+50*(Math.random()-.5),e.y=r.cy+50*(Math.random()-.5))}),{nodes:n,links:r}}(await async function(){const e=`${z}/neo4j/nodes?activeView=multilayer&project=${encodeURIComponent("multi-layer")}`,t=await fetch(e);if(!t.ok)throw new Error(`API multilayer 실패: ${t.status}`);return t.json()}());e&&V(t)}catch(t){e&&V(function(){const e=[],t=[];for(let r=0;r<30;r++)e.push({id:`dev-${r}`,layer:"physical",type:"server",label:`DEV-${r}`,status:"up",severity:0,x:(Math.random()-.5)*I,y:(Math.random()-.5)*I,z:S});for(let r=0;r<10;r++)e.push({id:`svc-${r}`,layer:"logical",type:"service",label:`SVC-${r}`,status:"up",severity:0,x:(Math.random()-.5)*I,y:(Math.random()-.5)*I,z:E});for(let r=0;r<10;r++)e.push({id:`user-${r}`,layer:"persona",type:"user",label:`USER-${r}`,status:"up",severity:0,x:(Math.random()-.5)*I,y:(Math.random()-.5)*I,z:P});for(let r=0;r<80;r++)t.push({source:`dev-${Math.floor(30*Math.random())}`,target:`svc-${Math.floor(10*Math.random())}`,kind:"HOSTS"});for(let r=0;r<80;r++)t.push({source:`user-${Math.floor(10*Math.random())}`,target:`svc-${Math.floor(10*Math.random())}`,kind:"USES"});return{nodes:e,links:t}}())}finally{e&&q(!1)}})(),()=>{e=!1}},[]),s.useEffect(()=>{const e=()=>{try{M.current&&M.current.zoomToFit(600,40)}catch{}};($.nodes?.length||$.links?.length)&&requestAnimationFrame(e);const t=T.current;let r;return t&&"undefined"!=typeof ResizeObserver?(r=new ResizeObserver(()=>requestAnimationFrame(e)),r.observe(t)):window.addEventListener("resize",e),()=>{r&&t&&r.unobserve(t),window.removeEventListener("resize",e)}},[$]),s.useEffect(()=>{const e=N.current;if(!e)return;const t=()=>{try{O({width:e.clientWidth||0,height:e.clientHeight||0})}catch{}};let r;if(t(),"undefined"!=typeof ResizeObserver){r=new ResizeObserver(()=>t());try{r.observe(e)}catch{}}else window.addEventListener("resize",t);return()=>{try{r&&e&&r.unobserve(e)}catch{}window.removeEventListener("resize",t)}},[]),s.useEffect(()=>{const e=M.current;if(!e)return;const t=e.renderer().domElement,r=e.scene(),n=Math.PI/6,s=1/0,i=Math.PI/60,a=()=>{r.rotation.x=v.clamp(r.rotation.x,-1.3,1.3),r.rotation.y=v.clamp(r.rotation.y,-n,n),r.rotation.z=v.clamp(r.rotation.z,-1/0,s),r.rotation.order="YXZ"};let l=!1,d=0,c=0,u=!1;const p=e=>e.clientX??(e.touches&&e.touches[0]?.clientX)??0,h=e=>e.clientY??(e.touches&&e.touches[0]?.clientY)??0,y=e=>{if(!l)return;const t=p(e),n=h(e),s=t-d,i=n-c;d=t,c=n,u?r.rotation.z+=.006*s:(r.rotation.y+=.006*s,r.rotation.x+=.005*i),a()},g=()=>{l=!1},x=e=>{try{if(("mouse"===e.pointerType||"number"==typeof e.button)&&2===e.button){try{e.preventDefault(),e.stopPropagation()}catch(t){}return}}catch(t){}l=!0,d=p(e),c=h(e)};t.addEventListener("pointerdown",x,{capture:!0});const f=e=>{try{e.preventDefault()}catch(t){}};t.addEventListener("contextmenu",f),window.addEventListener("pointermove",y),window.addEventListener("pointerup",g),t.addEventListener("pointerleave",g);const b=new o(1,1,1).normalize(),m=e=>{let t=!0;switch(e.key){case"ArrowUp":r.rotation.x-=i;break;case"ArrowDown":r.rotation.x+=i;break;case"ArrowLeft":r.rotation.y-=i;break;case"ArrowRight":r.rotation.y+=i;break;case"z":case"Z":r.rotation.z-=i;break;case"x":case"X":r.rotation.z+=i;break;case"r":case"R":r.rotation.set(0,0,0,"YXZ");break;case"u":case"U":r.rotateOnWorldAxis(b,+i),r.rotation.setFromQuaternion(r.quaternion,"YXZ");break;case"i":case"I":r.rotateOnWorldAxis(b,-i),r.rotation.setFromQuaternion(r.quaternion,"YXZ");break;default:t=!1}t&&a()},j=e=>{if("Space"===e.code||" "===e.key){u=!0;try{e.preventDefault()}catch{}}},w=e=>{if("Space"===e.code||" "===e.key){u=!1;try{e.preventDefault()}catch{}}};return window.addEventListener("keydown",m),window.addEventListener("keydown",j),window.addEventListener("keyup",w),()=>{t.removeEventListener("pointerdown",x),t.removeEventListener("contextmenu",f),window.removeEventListener("pointermove",y),window.removeEventListener("pointerup",g),t.removeEventListener("pointerleave",g),window.removeEventListener("keydown",m),window.removeEventListener("keydown",j),window.removeEventListener("keyup",w)}},[]);const le=s.useMemo(()=>{const e=new Set($.nodes.filter(e=>{if(!J[e.layer])return!1;if(G){const t=G.toLowerCase();if(![e.label,e.ip,e.user_name,e.role,e.dept,e.hostname,e.service_name,e.subnet,e.type].filter(Boolean).join(" ").toLowerCase().includes(t))return!1}return!0}).map(e=>e.id)),t=$.links.filter(t=>{const r=t.__sid||("object"==typeof t.source?t.source.id:t.source),n=t.__tid||("object"==typeof t.target?t.target.id:t.target);if(!e.has(r)||!e.has(n))return!1;if("all"!==ee&&!!t.assumed!=("true"===ee))return!1;const s=oe[r],i=oe[n];return!(s&&i&&(!re.has(s.status)||!re.has(i.status)))}),r=new Set;return t.forEach(e=>{const t=e.__sid||("object"==typeof e.source?e.source.id:e.source),n=e.__tid||("object"==typeof e.target?e.target.id:e.target);r.add(t),r.add(n)}),{nodes:$.nodes.filter(t=>e.has(t.id)&&(r.has(t.id)||!G)),links:t}},[$,J,ee,re,G,oe]),de=s.useMemo(()=>{if(!X)return{nodes:new Set,links:new Set};const e=new Set([X]),t=new Set;return(ae.get(X)||[]).forEach(t=>e.add(t)),le.links.forEach(r=>{const n=r.__sid||("object"==typeof r.source?r.source.id:r.source),s=r.__tid||("object"==typeof r.target?r.target.id:r.target);e.has(n)&&e.has(s)&&t.add(r)}),{nodes:e,links:t}},[X,le,ae]),ce=e=>X&&!de.links.has(e),ue=e=>{const t=new d(L[e.kind]||"#A0AEC0");return`#${(ce(e)?t.lerp(new d("#2A2A2A"),.6):t).getHexString()}`},pe=()=>{Z(null),n(null),w(null),ie([])},he=()=>{Z(null),n(null);const e=M.current;if(e){try{const t=e.scene().rotation;t.order="YXZ",t.x=0,t.y=0,t.z=0}catch{}e.cameraPosition({x:0,y:1800,z:0},{x:0,y:0,z:0},600)}},ye=t=>{if(Z(t?.id||null),t){const s=e.jsx(R,{selected:t,adj:ae,visible:le,byId:oe,onClearSelection:pe,onResetView:he});n(s);try{w(s)}catch(r){}const i=ae.get(t.id)||new Set,o=Array.from(i).map(e=>oe[e]).filter(e=>e&&e.ip).map(e=>e.ip),a=le.links.filter(e=>{const r=e.__sid||("object"==typeof e.source?e.source.id:e.source),n=e.__tid||("object"==typeof e.target?e.target.id:e.target);return r===t.id||n===t.id}).map(e=>{const t=e.__sid||("object"==typeof e.source?e.source.id:e.source),r=e.__tid||("object"==typeof e.target?e.target.id:e.target),n=oe[t],s=oe[r];return{src_IP:n?{id:n.id,ip:n.ip,name:n.label||n.hostname||n.name||n.user_name||n.service_name||n.id,type:n.type,subnet:n.subnet,dns:n.dns,gateway:n.gateway,description:n.description||n.service_name,cve:D(n),value:n.value,key:n.key,__labels:[n.layer,n.type],__id:n.id,index:n.index}:null,dst_IP:s?{id:s.id,ip:s.ip,name:s.label||s.hostname||s.name||s.user_name||s.service_name||s.id,description:s.description||s.service_name,cve:D(s),value:s.value,key:s.key,__labels:[s.layer,s.type],__id:s.id,index:s.index}:null,edge:{sourceIP:t,targetIP:r,kind:e.kind,rel:e.kind,assumed:e.assumed,confidence:e.confidence}}}),l={message:`노드 선택: ${t.label||t.id}`,nodeInfo:{layer:t.layer,type:t.type,ip:t.ip},connectedCount:i.size,connectedIps:o,dbInfo:a};ie([l])}else n(null),w(null),ie([])},ge=s.useMemo(()=>{if(U)return le;if(!X)return{nodes:le.nodes,links:[]};const e=new Set([X]);(ae.get(X)||[]).forEach(t=>e.add(t));const t=le.links.filter(t=>{const r=t.__sid||("object"==typeof t.source?t.source.id:t.source),n=t.__tid||("object"==typeof t.target?t.target.id:t.target);return e.has(r)||e.has(n)});return{nodes:le.nodes,links:t}},[U,le,X,ae]);return e.jsx(t,{ref:T,sx:{width:"100%",height:"calc(100vh - 120px)",bgcolor:"background.paper",borderRadius:2,boxShadow:3,overflow:"hidden"},children:e.jsxs(r,{sx:{p:2,height:"100%",display:"flex",gap:2},children:[e.jsx("div",{style:{flex:1,minWidth:0,height:"100%"},children:e.jsx("div",{style:{width:"100%",height:"100%",minHeight:600,color:"#fff",display:"flex",flexDirection:"row"},children:e.jsx(t,{sx:{flex:1,position:"relative",overflow:"hidden",borderRadius:"20px",boxShadow:"0 2px 8px rgba(57, 48, 107, 0.07)",background:"#0b1220",mr:1},children:e.jsxs("div",{ref:N,style:{width:"100%",height:"100%",position:"relative"},children:[e.jsx("div",{style:{position:"absolute",top:12,left:12,zIndex:10,background:"rgba(57,48,107,0.7)",backdropFilter:"blur(4px)",border:"1px solid rgba(255,255,255,0.1)",borderRadius:12,padding:12},children:e.jsxs("div",{style:{display:"flex",flexWrap:"wrap",gap:12,alignItems:"center",fontSize:12},children:[e.jsx("input",{placeholder:"검색: label, ip, user, role, dept...",value:G,onChange:e=>Q(e.target.value),style:{padding:"4px 8px",borderRadius:6,border:"1px solid rgba(128,128,128,0.5)",background:"rgba(20,20,20,0.7)",color:"#fff"}}),e.jsx("span",{style:{width:1,height:24,background:"rgba(255,255,255,0.1)"}}),["physical","logical","persona"].map(t=>e.jsxs("label",{style:{display:"flex",gap:6,alignItems:"center"},children:[e.jsx("input",{type:"checkbox",checked:J[t],onChange:e=>K(r=>({...r,[t]:e.target.checked}))}),e.jsxs("span",{style:{display:"inline-flex",gap:6,alignItems:"center"},children:[e.jsx("span",{style:{width:10,height:10,borderRadius:2,background:k[t]}}),e.jsx("span",{children:t})]})]},t)),e.jsx("span",{style:{width:1,height:24,background:"rgba(255,255,255,0.1)"}}),e.jsxs("label",{style:{display:"flex",alignItems:"center",gap:6},children:[e.jsx("span",{children:"assumed"}),e.jsxs("select",{value:ee,onChange:e=>te(e.target.value),style:{background:"rgba(20,20,20,0.7)",color:"#fff",border:"1px solid rgba(128,128,128,0.5)",borderRadius:6,padding:"2px 4px"},children:[e.jsx("option",{value:"all",children:"all"}),e.jsx("option",{value:"true",children:"true"}),e.jsx("option",{value:"false",children:"false"})]})]}),e.jsx("span",{style:{width:1,height:24,background:"rgba(255,255,255,0.1)"}}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8},children:[e.jsx("span",{children:"status"}),_.map(t=>e.jsxs("label",{style:{display:"flex",alignItems:"center",gap:6},children:[e.jsx("input",{type:"checkbox",checked:re.has(t),onChange:e=>{const r=new Set(re);e.target.checked?r.add(t):r.delete(t),ne(r)}}),e.jsx("span",{style:{textTransform:"uppercase"},children:t})]},t))]}),e.jsx("span",{style:{width:1,height:24,background:"rgba(255,255,255,0.1)"}}),e.jsx("button",{onClick:()=>Y(e=>!e),style:{padding:"4px 8px",borderRadius:6,background:U?"#3b82f6":"#F0EDFD",color:"#000",border:"1px solid rgba(128,128,128,0.5)"},children:U?"펄스 ON":"펄스 OFF"}),e.jsx("button",{onClick:()=>{Q(""),K({physical:!0,logical:!0,persona:!0}),te("all"),ne(new Set(_))},style:{padding:"4px 8px",borderRadius:6,background:"#F0EDFD",color:"#000",border:"1px solid rgba(128,128,128,0.5)"},children:"필터 초기화"}),e.jsx("button",{onClick:he,style:{padding:"4px 8px",borderRadius:6,background:"#F0EDFD",color:"#000",border:"1px solid rgba(128,128,128,0.5)"},children:"뷰 초기화"})]})}),e.jsx(a,{ref:M,graphData:ge,backgroundColor:"#0b1220",width:W.width,height:W.height,nodeAutoColorBy:null,nodeColor:e=>X&&(e=>X&&!de.nodes.has(e.id))(e)?"#2A2A2A":k[e.layer]||"#B0B0B0",nodeLabel:e=>`${e.label} (layer: ${e.layer})`,nodeRelSize:5.2,linkColor:ue,linkWidth:e=>ce(e)?.3:e.assumed?.6:1.5,linkMaterial:e=>{const t=new d(ue(e));if(e.assumed)try{return new c({color:t,dashSize:2,gapSize:1,transparent:!0,opacity:ce(e)?.25:.65})}catch{return new u({color:t,transparent:!0,opacity:ce(e)?.25:.65})}return new u({color:t,transparent:!0,opacity:ce(e)?.25:.95})},linkDirectionalParticles:e=>{if(!U||!X)return 0;const t=e.source,r=e.target;return t&&r&&void 0!==t.id&&void 0!==r.id?t.id!==X&&r.id!==X||(n=r,t.layer===n.layer)?0:2:0;var n},linkDirectionalParticleWidth:()=>2,linkDirectionalParticleSpeed:()=>.006+.004*Math.random(),onNodeClick:ye,onBackgroundClick:pe,onLinkClick:e=>{const t=e.__sid||("object"==typeof e.source?e.source.id:e.source),r=oe[t];r&&ye(r)},onLinkUpdate:(e,t)=>{try{const r=e.__lineObj||t;r&&r.computeLineDistances&&r.computeLineDistances()}catch{}},cooldownTicks:0,enableNodeDrag:!1,showNavInfo:!1}),H&&e.jsx("div",{style:{position:"absolute",left:0,top:0,right:0,bottom:0,display:"flex",alignItems:"center",justifyContent:"center",pointerEvents:"none"},children:e.jsx("div",{style:{background:"rgba(0,0,0,0.6)",color:"#fff",padding:"12px 18px",borderRadius:8,backdropFilter:"blur(4px)"},children:"Loading…"})})]})})})}),e.jsx(j,{eventLogs:se})]})})}export{N as default};
