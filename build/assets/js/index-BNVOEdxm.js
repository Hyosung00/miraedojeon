import{j as e}from"./mui-vendor-DRsyA_VI.js";import{c as r,a as o}from"./react-vendor-CP5_hn_0.js";import{N as t}from"./vis-network-CqERLR1V.js";import"./index-CbGKRZik.js";import"./index-BImhcsbi.js";import"./chart-vendor-BJu2iTGG.js";import"./three-vendor-C8Ar5e6p.js";function s(e){return"switch"===e.type?"/image/switch.png":"workstation"===e.type?"/image/workstation.png":"server"===e.type?"/image/server.png":"router"===e.type?"/image/router.png":"firewall"===e.type?"/image/firewall.png":"laptop"===e.type?"/image/laptop.png":"printer"===e.type?"/image/printer.png":"sensor"===e.type?"/image/sensor.png":"plc"===e.type?"/image/plc.png":"/logo192.png"}const n=r.memo(({dbNodes:n=[],onNodeClick:i,filterConditions:d})=>{const a=o.useRef(null),c=o.useRef(null),p=r.useCallback(e=>String(e?.__id??e?.id??e?.ip??e?.index??JSON.stringify(e)),[]),{nodes:l,edges:g}=r.useMemo(()=>{const e=[],r=[];return n.forEach(e=>{if(e.edge&&e.src_IP&&e.dst_IP){const t=p(e.src_IP),s=p(e.dst_IP),n="number"==typeof e.src_IP.degree_score?e.src_IP.degree_score:null;let i="solid";if(n<=.5&&(i="dashed"),"direct"===d?.connectionType&&!(n>.5))return;if("indirect"===d?.connectionType&&!(n>0&&n<=.5))return;const a={dashes:"dashed"===(o={...e.edge,edgeType:i}).edgeType||!0===o.isDashed,color:o.color||"#333",width:o.width||2,arrows:o.arrows||"to"};r.push({from:t,to:s,length:100+200*Math.random(),...a})}var o}),n.forEach(r=>{[r.src_IP,r.dst_IP].forEach(r=>{const o=p(r);if(r&&!e.some(e=>e.id===o)){const t=s(r),n=14,i=50;let d=.5;"number"==typeof r.degree_score&&"number"==typeof r.con_score&&(d=r.degree_score+r.con_score,d=Math.max(0,Math.min(1,d)));const a=n+(i-n)*d;e.push({id:o,label:r.label||r.ip||o,shape:"image",image:t,size:a})}})}),{nodes:e,edges:r}},[n,p,d]);return o.useEffect(()=>{const e={nodes:l,edges:g},r={layout:{randomSeed:1},nodes:{shape:"image",brokenImage:s({}),size:30,borderWidth:2,color:{border:"#b39ddb"},font:{size:18,color:"#222"}},edges:{},physics:!0};return a.current&&!c.current&&(c.current=new t(a.current,e,r),c.current.on("click",function(e){if(e.nodes&&e.nodes.length>0){const r=e.nodes[0],o=l.find(e=>e.id===r),t=new Set,s=[r];for(;s.length>0;){const e=s.shift();t.has(e)||(t.add(e),g.forEach(r=>{r.from!==e||t.has(r.to)||s.push(r.to),r.to!==e||t.has(r.from)||s.push(r.from)}))}const d=Array.from(t).filter(e=>e!==r),a=d.length,c=new Set;d.forEach(e=>{const r=l.find(r=>r.id===e);r?.label&&c.add(r.label),r?.ip&&c.add(r.ip)});let f=o?.ip||o?.label;const m=Array.from(c).filter(e=>e!==f),u=n.find(e=>p(e.src_IP)===r||p(e.dst_IP)===r);i&&i({...o,connectedCount:a,connectedIps:m,dbInfo:u?[{src_IP:u.src_IP,dst_IP:u.dst_IP,edge:u.edge}]:[]})}})),()=>{c.current&&(c.current.destroy(),c.current=null)}},[n,l,g]),e.jsx("div",{className:"target-graph-canvas",ref:a})});n.displayName="TargetGraph2D";export{n as default};
